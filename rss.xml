<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title><![CDATA[Blog - Jianhua Cheng]]></title><description><![CDATA[A place to write out somethings I knew and I start to wanna know.]]></description><link>https://chengjianhua.github.io</link><generator>RSS for Node</generator><lastBuildDate>Sun, 01 Apr 2018 14:38:10 GMT</lastBuildDate><item><title><![CDATA[前端单元测试实践]]></title><description><![CDATA[…]]></description><link>https://chengjianhua.github.io/fe-unit-testing-practice/</link><guid isPermaLink="false">https://chengjianhua.github.io/fe-unit-testing-practice/</guid><pubDate>Thu, 07 Dec 2017 13:26:00 GMT</pubDate><content:encoded>&lt;blockquote&gt;
&lt;p&gt;本文将假设读者已经对单元测试有基本了解（大致知道单元测试是什么），文中提及的话题比较多，不能一一详述，具体内容请参照提供的链接进一步了解。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;但凡谈到工程质量及相关实践都免不了提到 &lt;strong&gt;单元测试&lt;/strong&gt;，这是一个老生常谈却长久不衰的话题。对前端来说也早就不是新鲜事物，我们在平时开发过程中使用到的开源项目基本没有能够不包含单元测试就能被广泛使用的。&lt;/p&gt;
&lt;p&gt;不少开源项目都会使用一个 badge 来标识出其测试覆盖率以使我们相信：我们正在查阅的项目是“久经考验”、“值得信任的”。下方以 react 为例：&lt;/p&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/0A4544C0-00DC-4C23-8E5A-3BC4F0043679-bee7b5790afc50bb3d30135c806776a5-e7ea1.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block; ; max-width: 590px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 12.11340206185567%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAAsSAAALEgHS3X78AAAAoUlEQVQI1wXB2wrBYADAcU+pXHkAb+DOrfNhZbsieQKiuFESNcW3HL59JkpZ1GwjklN/v19kfnjinF/49y+n64fg8SPwL8j1mpVUjHcei2PIdmMjpMNoHzLchcijj6NspK1QaonrmgSBQ6QlbmR7Hvm+R3VwYeW+ETOTYiFPpqQRr09ItS1qukYyZxBrWkQbgkx7iqGVKFeq6HqaTjeBsAz+ShKEUBuMiPEAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;0A4544C0 00DC 4C23 8E5A 3BC4F0043679&quot;
        title=&quot;&quot;
        src=&quot;/static/0A4544C0-00DC-4C23-8E5A-3BC4F0043679-bee7b5790afc50bb3d30135c806776a5-fb8a0.png&quot;
        srcset=&quot;/static/0A4544C0-00DC-4C23-8E5A-3BC4F0043679-bee7b5790afc50bb3d30135c806776a5-1a291.png 148w,
/static/0A4544C0-00DC-4C23-8E5A-3BC4F0043679-bee7b5790afc50bb3d30135c806776a5-2bc4a.png 295w,
/static/0A4544C0-00DC-4C23-8E5A-3BC4F0043679-bee7b5790afc50bb3d30135c806776a5-fb8a0.png 590w,
/static/0A4544C0-00DC-4C23-8E5A-3BC4F0043679-bee7b5790afc50bb3d30135c806776a5-e7ea1.png 776w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;p&gt;甚至有些时候测试的代码量比功能代码量还要多得多：&lt;/p&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/D8C37397-49A2-4187-81B8-8797F9D70410-a41cb60979c4a7a7ce2c5f617e0b5f4c-71f4d.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block; ; max-width: 590px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 10.90909090909091%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAAsSAAALEgHS3X78AAAAaElEQVQI11XM0QqDMAyF4VObEa21sbIJbpO+/1Meg3ihFx/5QyBAtxChEigue5erJ2/zObhwAWMUigrRgyGC6G6CG/LG0RqtNs5LY58+LPOfpe7Mtvu+crKv339M45siSk16PnxQ9wIPU1IrW2nKn4cAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;D8C37397 49A2 4187 81B8 8797F9D70410&quot;
        title=&quot;&quot;
        src=&quot;/static/D8C37397-49A2-4187-81B8-8797F9D70410-a41cb60979c4a7a7ce2c5f617e0b5f4c-fb8a0.png&quot;
        srcset=&quot;/static/D8C37397-49A2-4187-81B8-8797F9D70410-a41cb60979c4a7a7ce2c5f617e0b5f4c-1a291.png 148w,
/static/D8C37397-49A2-4187-81B8-8797F9D70410-a41cb60979c4a7a7ce2c5f617e0b5f4c-2bc4a.png 295w,
/static/D8C37397-49A2-4187-81B8-8797F9D70410-a41cb60979c4a7a7ce2c5f617e0b5f4c-fb8a0.png 590w,
/static/D8C37397-49A2-4187-81B8-8797F9D70410-a41cb60979c4a7a7ce2c5f617e0b5f4c-526de.png 885w,
/static/D8C37397-49A2-4187-81B8-8797F9D70410-a41cb60979c4a7a7ce2c5f617e0b5f4c-fa2eb.png 1180w,
/static/D8C37397-49A2-4187-81B8-8797F9D70410-a41cb60979c4a7a7ce2c5f617e0b5f4c-71f4d.png 1320w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/facebook/react/commit/0752a63f59168b56b14ec45220bad97b39222604&quot;&gt;add Portal support to React.Children calls (#11378) · facebook/react@0752a63 · GitHub&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;对我们来说，无论是内部基础库还是业务代码都应该有单元测试，只是比重各不相同。也许有人觉得将开源项目类比业务代码并合理，但对于开源项目来说，单元测试是一个在持续迭代中不会意外破坏原有功能的保证。同时较高的测试覆盖率（稍后也会谈到覆盖率对于单元测试的意义）能进一步给予使用者甚至开发者足够的自信：这是一个可靠的项目，没有隐藏的 bug。单元测试对于开源项目能够解决的问题也正是我们业务代码所关心的，我们需要在持续的功能迭代中确保其中重要逻辑的正常工作以及不会破坏原有业务逻辑的正常工作。对于内部的公共项目，我们更应该像对待一个开源项目来对待它，保证足够多的测试来覆盖各种情况，以保证多个依赖于它的项目能如预期得工作。&lt;/p&gt;
&lt;h2&gt;测试框架的选择&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;TL;DR&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;以上主要是简单介绍了一下单元测试，本部分将介绍如何开始实践单元测试。&lt;/p&gt;
&lt;p&gt;在此将主要介绍两个较受广泛使用也是我都亲自尝试过的测试工具：&lt;a href=&quot;https://github.com/mochajs/mocha&quot;&gt;mocha&lt;/a&gt;、&lt;a href=&quot;https://github.com/facebook/jest&quot;&gt;Jest&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;mocha 估计仍是目前最流行的测试框架。在大半年前第一次尝试编写单元测试时我随便查询了一些资料，这些资料基本都是关于 mocha 的，教程很多，很容易就能开始按照教程搭建环境了。当时的 Jest 虽然是 facebook 出品且号称不需要繁琐的配置但是终究不敌 mocha 庞大的用户群。出于对稳妥的考虑，我仍然选择的 mocha。当然在现在尝试过 Jest 的我看来，我会极力推荐准备写测试以及没有在使用 Jest 的人选择 Jest，这是个非常棒的选择。&lt;/p&gt;
&lt;p&gt;接下来我将就几个切入点来分别简述两者的区别与优缺点。&lt;/p&gt;
&lt;h3&gt;断言&lt;/h3&gt;
&lt;p&gt;mocha 没有集成 &lt;strong&gt;断言&lt;/strong&gt; 库，当然不使用断言库的话也可以使用 node 内置的 &lt;code class=&quot;language-text&quot;&gt;assert&lt;/code&gt;。也可以自己选择断言库，当时最容易搜到的也就是 &lt;a href=&quot;http://chaijs.com/&quot;&gt;Chai&lt;/a&gt;。当然，除此之外还有很多其他的选择，mocha 的文档里就有提到多个选择 &lt;a href=&quot;https://mochajs.org/#assertions&quot;&gt;Mocha - Assertions&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;当时我选择的是 chai。第一次使用 chai 中 BDD 风格的断言（should）时我非常兴奋，因为它的 API 具备极高的可读性，写起测试来非常的顺手。以下举个例子，一看便知：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;user&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;should&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;be&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;an&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;object&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;that&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;have&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;property&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;nick&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;顺带一提，以上这种方式是通过扩展 &lt;code class=&quot;language-text&quot;&gt;Object.prototype&lt;/code&gt; 来将 &lt;code class=&quot;language-text&quot;&gt;should&lt;/code&gt; 挂载到所有对象上（所有对象都继承自 &lt;code class=&quot;language-text&quot;&gt;Object&lt;/code&gt;），从而实现了这种链式调用的方式。基于以上的实现原理，这种断言风格也是有缺陷的：如果 &lt;code class=&quot;language-text&quot;&gt;user&lt;/code&gt; 的值是 &lt;code class=&quot;language-text&quot;&gt;null&lt;/code&gt; 的情况下，在 &lt;code class=&quot;language-text&quot;&gt;.should&lt;/code&gt; 这就会抛出异常了。原因是 &lt;code class=&quot;language-text&quot;&gt;null&lt;/code&gt; 不继承自 Object.变通方法则是换成这种写法 &lt;code class=&quot;language-text&quot;&gt;should(user).be&lt;/code&gt; 。&lt;/p&gt;
&lt;p&gt;以上稍微扯远了点，chai 虽然跟 mocha 本身无关，但是作为 mocha 常见搭配的断言库值得一提。&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;相比之下，Jest 自身是集成了断言功能的，&lt;code class=&quot;language-text&quot;&gt;expect&lt;/code&gt; 挂载在 &lt;code class=&quot;language-text&quot;&gt;global&lt;/code&gt; 上。举个例子：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token function&quot;&gt;expect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;drink&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;not&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;toHaveBeenCalled&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;Jest 的文档中并不推荐使用其他第三方的断言库，毕竟自身集成的断言对 Jest 本身有更良好的适配。这样一来也省去了选择的纠结。自身集成的 &lt;code class=&quot;language-text&quot;&gt;expect&lt;/code&gt; 挺好用的，API 也很丰富，足以支持各种复杂条件的断言。&lt;/p&gt;
&lt;p&gt;更值得一提的是，如果你之前的测试代码中的断言使用的是 chai 的话，仍然可以继续使用，这样进一步减少了迁移成本。并且 Jest 提供了测试代码迁移工具 &lt;a href=&quot;https://github.com/skovhus/jest-codemods&quot;&gt;GitHub - skovhus/jest-codemods: Codemods for migrating to Jest 👾&lt;/a&gt;，足以将原先使用其他测试框架编写的测试代码在不需要人工的情况下自动转换成 Jest 风格的测试代码。&lt;/p&gt;
&lt;p&gt;具体细节可以查看 &lt;a href=&quot;http://facebook.github.io/jest/docs/en/migration-guide.html&quot;&gt;Migrating to Jest · Jest&lt;/a&gt;。&lt;/p&gt;
&lt;h3&gt;测试覆盖率报告&lt;/h3&gt;
&lt;p&gt;mocha 自身不集成 &lt;strong&gt;测试覆盖率&lt;/strong&gt; 功能。这项功能能让我们直观地从数字上感受到我们测试覆盖的情况和效果。一般用于实现这项功能所用的是 &lt;a href=&quot;https://istanbul.js.org/&quot;&gt;Istanbul, a JavaScript test coverage tool.&lt;/a&gt;。当然它所提供的不仅仅是测试覆盖率，还有具体测试覆盖到哪一行、哪一个条件分支、每条语句分别执行了多少次等功能。&lt;/p&gt;
&lt;p&gt;当我们将它与 mocha 结合的话我们通常会使用 &lt;a href=&quot;https://github.com/istanbuljs/nyc&quot;&gt;GitHub - istanbuljs/nyc: the Istanbul command line interface&lt;/a&gt; 来生成我们的测试报告。使用方式大概如下：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;nyc --reporter&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;html --reporter&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;text mocha
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;以上命令将会生成两种测试报告，一种 &lt;code class=&quot;language-text&quot;&gt;--reporter=text&lt;/code&gt; 将在终端输出测试覆盖率相关的文本信息。另一种 &lt;code class=&quot;language-text&quot;&gt;--reporter=html&lt;/code&gt; 将会生成一个 &lt;code class=&quot;language-text&quot;&gt;coverage&lt;/code&gt; 文件夹，并且其中的 &lt;code class=&quot;language-text&quot;&gt;coverage/index.html&lt;/code&gt; 可以在浏览器中打开。打开之后就是一个非常详细的测试覆盖率报告页面，前面提到的 &lt;em&gt;测试覆盖到哪一行、哪一个条件分支、每条语句分别执行了多少次&lt;/em&gt; 就是在这个页面里可以查看到。&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;毫不意外，Jest 自身集成了 istanbul，你所需要关心的也只是在运行测试的时候多加一个 &lt;code class=&quot;language-text&quot;&gt;--coverage&lt;/code&gt; 选项而已。coverage 也是可以配置的，具体参考 &lt;a href=&quot;http://facebook.github.io/jest/docs/en/configuration.html#coveragereporters-array-string&quot;&gt;Configuring Jest · Jest&lt;/a&gt;。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# npm test&lt;/span&gt;
jest

&lt;span class=&quot;token comment&quot;&gt;# npm run coverage&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;npm&lt;/span&gt; run &lt;span class=&quot;token function&quot;&gt;test&lt;/span&gt; -- --coverage
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;h3&gt;测试环境&lt;/h3&gt;
&lt;p&gt;当你需要测试的部分逻辑需要使用到浏览器才具备的一些 API，例如：&lt;code class=&quot;language-text&quot;&gt;document&lt;/code&gt;、&lt;code class=&quot;language-text&quot;&gt;location&lt;/code&gt; 以及 DOM 操作等等浏览器环境才具备的 API。此时我们不可避免地需要 mock 这些实现。如果你不是只想简单地让测试代码不会在 node 环境中失败，而是期望仍然具备应有的逻辑，那么我们就需要引入 &lt;a href=&quot;https://github.com/tmpvar/jsdom&quot;&gt;GitHub - tmpvar/jsdom: A JavaScript implementation of the WHATWG DOM and HTML standards, for use with node.JavaScript&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;当你按照文档设置之后它可以为我们在 node 端模拟出一个高度还原的浏览器环境。使用 mocha 的话也就是在一个 &lt;code class=&quot;language-text&quot;&gt;setup.js&lt;/code&gt; 中完成这一步骤，这个文件将先于所有测试文件先运行且仅运行一次，用于预先配置好测试环境。&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Jest 依然自身集成了 &lt;code class=&quot;language-text&quot;&gt;jsdom&lt;/code&gt;，且默认开启。可以通过 &lt;a href=&quot;http://facebook.github.io/jest/docs/en/configuration.html#testenvironment-string&quot;&gt;Configuring Jest · Jest&lt;/a&gt; 中的配置项改变默认配置。&lt;/p&gt;
&lt;h3&gt;mock&lt;/h3&gt;
&lt;p&gt;单元测试不可避免得需要用到 mock，在这里 mock 的大致意思是：屏蔽一个函数或一个模块的方法（属性）原有实现或值，然后使用我们期望的实现或值代替它。&lt;/p&gt;
&lt;p&gt;针对于方法的 mock，由于 mocha 本身并没有支持这一相关的功能，通常我们会选择 &lt;a href=&quot;http://sinonjs.org/&quot;&gt;Sinon.js - Standalone test spies, stubs and mocks for JavaScript. Works with any unit testing framework.&lt;/a&gt;(&lt;a href=&quot;http://sinonjs.org/&quot;&gt;http://sinonjs.org/&lt;/a&gt;) 来完成 mock 相关操作。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token function&quot;&gt;it&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;returns the return value from the original function&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; callback &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; sinon&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;stub&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;returns&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;42&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; proxy &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;once&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;callback&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

  assert&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;equals&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;proxy&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;42&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;如果是依赖模块的 mock 由于涉及到依赖的问题就更棘手了，可以借助于 &lt;a href=&quot;https://github.com/boblauer/mock-require&quot;&gt;GitHub - boblauer/mock-require: Simple, intuitive mocking of Node.JavaScript modules.&lt;/a&gt; 这样的库来完成。&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Jest 自身集成了对 mock 的支持。使用 Jest 编写测试时，在测试代码中可通过全局对象 &lt;code class=&quot;language-text&quot;&gt;jest&lt;/code&gt; 中的属性方法 &lt;code class=&quot;language-text&quot;&gt;fn&lt;/code&gt; 创建一个 spy，这是针对方法的 spy。还有一个类似的是 &lt;code class=&quot;language-text&quot;&gt;jest.spyOn&lt;/code&gt; ，用于生成一个作用于对象方法的 spy 或 mock。&lt;/p&gt;
&lt;p&gt;但是 Jest 中的 &lt;code class=&quot;language-text&quot;&gt;jest.spyOn()&lt;/code&gt; 不是太强大，只能对对象中的方法进行 mock，如果是非方法属性的话：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;1. 通过一个变量存储原始值，随后赋予指定测试所用值，在测试完成之后再还原到初始值；
2. 使用 `jest.spyOn` 创建一个改对象属性值的 getter，在 getter 中返回自己期望的值，测试完成之后去除该 getter。&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;以上两种方式都略显繁琐，当然也能自己封装成一个工具方法。其实可以使用 &lt;code class=&quot;language-text&quot;&gt;sinon.stub&lt;/code&gt; 来完成以上的功能，在 Jest 已有工具不足以满足使用需求的情况下，我们还是需要借助于社区来满足，示例如下：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; myObj &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  prop&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;foo&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; stub &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; sinon&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;stub&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;myObj&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;prop&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

stub&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getterFn&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;bar&apos;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

myObj&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;prop &lt;span class=&quot;token comment&quot;&gt;// &apos;bar&apos;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;这个工具的好处是随后可以使用 &lt;code class=&quot;language-text&quot;&gt;stub.restore()&lt;/code&gt; 来恢复到初始状态，比手写更加方便以及语义化。&lt;/p&gt;
&lt;p&gt;如果是针对于模块的 mock，那 jest 的支持就更是强大无比了，自身集成了 &lt;code class=&quot;language-text&quot;&gt;jest.mock()&lt;/code&gt; 来完成对模块的 mock。有一个配置项是能开启 &lt;strong&gt;auto mock&lt;/strong&gt;。顾名思义，开启此项后所有的模块中对其他模块的依赖都将会被自动 mock 掉，替换成一个没有具体实现的模块。我本人目前看来不是很推荐这样使用。详见 &lt;a href=&quot;http://facebook.github.io/jest/docs/en/manual-mocks.html#content&quot;&gt;Manual Mocks · Jest&lt;/a&gt;。&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;无论是 mocha 或者 Jest 本身在 mock 的过程中都会遇到一个问题：如何 mock 模块中一个没有被导出的私有变量或方法。对此有个 &lt;a href=&quot;https://github.com/speedskater/babel-plugin-rewire&quot;&gt;GitHub - speedskater/babel-plugin-rewire: A babel plugin adding the ability to rewire module dependencies. This enables to mock modules for testing purposes.&lt;/a&gt; 能够做到，缺点是很久没有在维护了，好在尚能使用，暂时没有找到比较好的替代。&lt;/p&gt;
&lt;h3&gt;Snapshot&lt;/h3&gt;
&lt;p&gt;这个特性算是 Jest 的王牌之一了，它能够记住你当时所测试对象（可以是对象、React element 等）的结构并输出成一个单独的 &lt;code class=&quot;language-text&quot;&gt;xxx.snap&lt;/code&gt; 文件用于保存结构。对于对象就会生成一个类似 JSON 的结构，如果是 React Element 的话会生成一个类似于 DOM 的结构。&lt;/p&gt;
&lt;p&gt;这个功能带来的好处是：当你下次改变代码实现时，如果是无意中改变导致的快照测试失败，你能很快地发现是错误的实现产生了不该有的影响，可以修复实现直到测试通过；如果是有意的就需要传递一个 &lt;code class=&quot;language-text&quot;&gt;--updateSnapshot&lt;/code&gt; 来更新生成新的快照。对于测试 React Component 的话非常的便利。&lt;/p&gt;
&lt;p&gt;以下给出一个我们实际代码中生成的快照信息：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;exports[`track/tracker should render correct DOM structure 1`] = `
&amp;lt;withTrackContext(OriginalTrackerChildren)&amp;gt;
  &amp;lt;OriginalTrackerChildren
    tracker={
      Object {
        &amp;quot;action&amp;quot;: [Function],
        &amp;quot;config&amp;quot;: [Function],
        &amp;quot;page&amp;quot;: [Function],
        &amp;quot;track&amp;quot;: Object {},
      }
    }
  &amp;gt;
    &amp;lt;div&amp;gt;
      Tracker Children
    &amp;lt;/div&amp;gt;
  &amp;lt;/OriginalTrackerChildren&amp;gt;
&amp;lt;/withTrackContext(OriginalTrackerChildren)&amp;gt;
`;&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;还有一个很好的使用场景就是错误信息。我们会在某些条件下输出错误信息，如果这些错误信息是很重要的话，我们除了需要测试方法是否会抛出异常外，还需要测试错误信息输出的具体内容。在 mocha 中使用 chai 的话会是这样的：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token function&quot;&gt;expect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;badFn&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;to&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;throw&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  Error&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token regex&quot;&gt;/This is a long error message that is too troublesome to copy it from codes./&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;这样写的弊病除了繁琐之外还有一点：错误信息存在了冗余。除此之外，当在实现中改变了错误信息还需要在对应的测试中修改。如果使用 Jest 的快照功能的话则是这样的：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token function&quot;&gt;expect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;badFn&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;toThrowErrorMatchingSnapshot&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;以上代码会生成一个错误信息的 snapshot。&lt;/p&gt;
&lt;p&gt;mocha 也能通过一些库来达到以上类似的效果，不过已经比较到了这里我相信你们会选择 Jest 的 : )&lt;/p&gt;
&lt;h3&gt;Watch&lt;/h3&gt;
&lt;p&gt;当你开启 &lt;code class=&quot;language-text&quot;&gt;--watch&lt;/code&gt; 模式时，mocha 会在你改动之后运行所有的测试，无论是不是跟当前文件相关的测试，除非手动指定希望被监听的文件列表。而 Jest 可就不是这样了。它不会运行所有的测试，而是会识别出当前文件相关的其他测试文件并运行，可大大缩短监听测试的时间，同时也提高了体验。举个例子：&lt;/p&gt;
&lt;p&gt;如果你修改了 &lt;code class=&quot;language-text&quot;&gt;a.js&lt;/code&gt;，且 &lt;code class=&quot;language-text&quot;&gt;b.js&lt;/code&gt; 中依赖了 &lt;code class=&quot;language-text&quot;&gt;a.js&lt;/code&gt; 这个模块，此时除了会运行 &lt;code class=&quot;language-text&quot;&gt;a.spec.js&lt;/code&gt; 之外还会运行 &lt;code class=&quot;language-text&quot;&gt;b.spec.js&lt;/code&gt; 。这很合理！&lt;/p&gt;
&lt;p&gt;这样带来的好处是如果你使用 &lt;a href=&quot;https://github.com/okonet/lint-staged&quot;&gt;GitHub - okonet/lint-staged: 🚫💩 — Run linters on git staged files&lt;/a&gt; 的话，你甚至可以在提交代码前仅运行 staged files 相关的测试，这样会导致测试失败的代码永远不会进入代码库。当然这样是一个很严格的实践，根据具体情况斟酌。&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;以上是几个我们写测试时比较关心的特性，还有很多特性例如 &lt;strong&gt;异步测试&lt;/strong&gt; 之类的特性二者大同小异，所以就不详细列举这些特性了。在我的实际使用中，我都通过 mocha 和 Jest 写了不少测试单元测试，都保证了一些公有依赖的功能在迭代改进、重构中没有被意外破坏。有几次甚至我都怀疑是测试框架有 bug，但是最终还是被证明是隐藏很深的 bug 导致的。这更让我坚定了单元测试对于工程的作用。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;其中使用 Jest 编写测试会方便很多，减少了很多繁琐的配置&lt;/strong&gt;，几乎是零配置（只需要少量简单的配置即可）。同时 snapshot 以及 mock 等功能极大的&lt;strong&gt;节省了我测试的时间&lt;/strong&gt;，所以我会极力推荐 Jest，即使你不是使用 React 也是一样能享受到它所有的有点，它与 React 并没有依赖关系。现在我们内部公共模块的测试就是使用 Jest 完成的，👍！&lt;/p&gt;
&lt;p&gt;以上跟 mocha 有关的配置我轻描淡写的就带过了，实际上 mocha 的配置是需要仔细阅读文档，尝试过一些失败之后才能配置成功的。不得不说在有些时候我们并不关心所谓的灵活性，只期望能尽快开始，毕竟万事开头难，被拦在了开头就更不好了。mocha 的配置确实繁琐了些……&lt;/p&gt;
&lt;h2&gt;Unit Test v.s. Integration Test&lt;/h2&gt;
&lt;p&gt;以上我推荐了 Jest 作为我们的测试工具，现在我要谈一下在写测试中我们经常会纠结的一个问题：&lt;strong&gt;如何区分单元测试和集成测试&lt;/strong&gt;。对于这个问题我也不是很能说清楚，概念也很无趣。某次我在一篇文中中看到了这样一段话我觉得非常有道理：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;The line between integration and unit tests is a little bit fuzzy. Regardless, I think the biggest thing you can do to write more integration tests is to just stop mocking so much stuff.&lt;br&gt;
&lt;a href=&quot;https://blog.kentcdodds.com/write-tests-not-too-many-mostly-integration-5e8c7fff591c&quot;&gt;Write tests. Not too many. Mostly integration. – Kent C. Dodds&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;这样的定义简单粗暴但却很有效，如果一个模块依赖了很多模块，我们如果不去 mock 那些依赖而是直接运行测试，这就相当于一个集成测试。因为这同时测试了多个模块是否正常工作（换个角度来说集成测试和单元测试是多么的相似）。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;That means that the code you use to set up network requests and request handlers won’t need unit tests. Use integration tests for those, instead.&lt;br&gt;
&lt;a href=&quot;https://medium.com/javascript-scene/mocking-is-a-code-smell-944a70c90a6a&quot;&gt;Mocking is a Code Smell – Eric Elliott&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;一定程度上我认可以上所说。这位作者认为当你需要模拟请求返回的值时也许你需要的是集成测试而不是单元测试。毕竟单元测试不是用来覆盖所有代码的，当设计多个模块之间的集成以及复杂 IO 等情况也许就不要使用单元测试来覆盖相应逻辑了，而使用集成测试甚至端对端测试更好。&lt;/p&gt;
&lt;h2&gt;Tips&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;测试代码也是 code base 的一部分&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;测试代码也是需要人来维护的，测试代码也要写得尽量的利于维护。需要复用的也要做到复用，否则之后改动测试的时候也是一场灾难。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;使用 Snapshot 小程度上代替端对端测试&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;对于创业公司团队，有些时候一些最佳实践我们未必有人力与时间去遵循，但是单元测试这件事确实是值得的，&lt;strong&gt;回报 &gt;&gt; 产出&lt;/strong&gt;。尤其是在频繁的迭代中，也许我们无法使用这一套去覆盖到每个页面的测试，但是公共模块必须使用。对于页面也有迂回的替代品，在没有端对端测试的情况下，我们可以很简单的生成页面组件的快照。可以一定程度保证上页面不会被改坏。&lt;/p&gt;
&lt;p&gt;在我们现有的流程中，如果某个开发者意外的 push 了一段代码会导致页面渲染异常，那么在 git push 触发了 GitLab CI 之后，会在 pipeline 中的 test 环节失败，这样一来发布也会失败。并且邮件会通知到 push 代码的那位开发者。测试结合 CI 能尽快的发现问题。当然如果你期望更早发现问题的话，推荐两个辅助工具：&lt;a href=&quot;https://github.com/typicode/husky&quot;&gt;husky&lt;/a&gt; 和 &lt;a href=&quot;https://github.com/okonet/lint-staged&quot;&gt;lint-staged&lt;/a&gt;结合。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;测试覆盖率不是全部&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;不能一昧追求测试覆盖率，测试覆盖率也有几种指标：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Statements：语句。这个是我们一般常见的测试覆盖率所采用的指标，它指的是所执行的语句占全部语句的百分比。&lt;/li&gt;
&lt;li&gt;Branch：分支。&lt;code class=&quot;language-text&quot;&gt;if else&lt;/code&gt;、&lt;code class=&quot;language-text&quot;&gt;? :&lt;/code&gt; 以及 &lt;code class=&quot;language-text&quot;&gt;switch&lt;/code&gt; 等条件语句都会产生分支，这个指的是测试所覆盖的分支数占据总分支数的百分比。&lt;/li&gt;
&lt;li&gt;Functions：函数。&lt;/li&gt;
&lt;li&gt;Lines：行数。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;前两个是常用比较有意义的指标。其中不能过度依赖第一个指标，因为如果代码的分支很多，而分支中的逻辑又很重要，那么即使每条语句都运行到了但是各种条件组合下的分支却没有得到充分测试，这样的测试其实并不能保证足够的安全性。&lt;/p&gt;
&lt;p&gt;除此之外不能盲目地追求测试覆盖率，不是越高的测试覆盖率就一定越好。我们只需要测试我们值得测试的部分，写测试花费的时间也是成本。&lt;strong&gt;从 90 到 100 所需要付出的时间远多于 60 ~ 85&lt;/strong&gt;。我们应该以效率为主，除非是时间充裕或者是非常重要的模块，否则不要盲目追求高覆盖率。&lt;/p&gt;
&lt;p&gt;……&lt;/p&gt;
&lt;p&gt;很多细节话题展开都能是一篇小文章，只能大致介绍一二，即使如此，以上篇幅不觉间已经过于冗长……我们还在探索如何更好地维护我们的代码，希望有机会能分享更多，谢谢阅读 😊&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Mocha 和 Chai 入门初探]]></title><description><![CDATA[Chai 在和   作比较的时候, 两者主要的不同就是   的集成度比较高内置断言库, 而   需要搭配额外的断言库, 在此选择了比较流行的   作为断言库. 风格的选择 其中   又有好几种断言风格, 我们经常见到的其实就是  BDD…]]></description><link>https://chengjianhua.github.io/first-triage-to-unite-test-in-mocha/</link><guid isPermaLink="false">https://chengjianhua.github.io/first-triage-to-unite-test-in-mocha/</guid><pubDate>Wed, 14 Dec 2016 17:14:44 GMT</pubDate><content:encoded>&lt;h2&gt;Chai&lt;/h2&gt;
&lt;p&gt;在和 &lt;code class=&quot;language-text&quot;&gt;jest&lt;/code&gt; 作比较的时候, 两者主要的不同就是 &lt;code class=&quot;language-text&quot;&gt;jest&lt;/code&gt; 的集成度比较高内置断言库, 而 &lt;code class=&quot;language-text&quot;&gt;mocha&lt;/code&gt; 需要搭配额外的断言库, 在此选择了比较流行的 &lt;code class=&quot;language-text&quot;&gt;chai&lt;/code&gt; 作为断言库.&lt;/p&gt;
&lt;h3&gt;风格的选择&lt;/h3&gt;
&lt;p&gt;其中 &lt;code class=&quot;language-text&quot;&gt;chai&lt;/code&gt; 又有好几种断言风格, 我们经常见到的其实就是 &lt;em&gt;BDD&lt;/em&gt; 风格的 &lt;code class=&quot;language-text&quot;&gt;should / expect&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;其中我较喜欢 &lt;code class=&quot;language-text&quot;&gt;should&lt;/code&gt;, 因为它可以直接以属性的方式嵌入所有内置原生对象, 所以可以很方便的以 &lt;code class=&quot;language-text&quot;&gt;variable.should.equal(someValue)&lt;/code&gt; 的形式来书写断言, 和 &lt;code class=&quot;language-text&quot;&gt;expect&lt;/code&gt; 相比较可以省略一对 &lt;code class=&quot;language-text&quot;&gt;()&lt;/code&gt; … 如果是 &lt;code class=&quot;language-text&quot;&gt;expect&lt;/code&gt; 风格的话, 上述示例代码等价于 &lt;code class=&quot;language-text&quot;&gt;expect(variable).to.equal(someValue)&lt;/code&gt;. 在一般情况下两者的使用时几乎相同的, &lt;code class=&quot;language-text&quot;&gt;expect&lt;/code&gt; 作为断言的开始, &lt;code class=&quot;language-text&quot;&gt;should&lt;/code&gt; 接在想要断言的变量之后. 但是有一些地方 &lt;code class=&quot;language-text&quot;&gt;should&lt;/code&gt; 就需要变换一下我上述所说的写法了.&lt;/p&gt;
&lt;!--more--&gt;
&lt;h4&gt;Should&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;should&lt;/code&gt; 实际上是给所有的对象都扩充了一个 &lt;code class=&quot;language-text&quot;&gt;getter&lt;/code&gt; 属性 &lt;code class=&quot;language-text&quot;&gt;should&lt;/code&gt;, 如果你想在浏览器中运行测试的话, &lt;code class=&quot;language-text&quot;&gt;should&lt;/code&gt; 在 IE 浏览器中会有一些问题. 正是因为 &lt;code class=&quot;language-text&quot;&gt;should&lt;/code&gt; 是扩充了 &lt;code class=&quot;language-text&quot;&gt;Object.prototype&lt;/code&gt;, 所以如果变量的值为 &lt;code class=&quot;language-text&quot;&gt;null&lt;/code&gt; 或 &lt;code class=&quot;language-text&quot;&gt;undefined&lt;/code&gt; 的时候, 是无法使用 &lt;code class=&quot;language-text&quot;&gt;.should.equal()&lt;/code&gt; 的形式的, 因为 &lt;code class=&quot;language-text&quot;&gt;null&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;undefined&lt;/code&gt; 的原型不是 &lt;code class=&quot;language-text&quot;&gt;Object&lt;/code&gt;,所以&lt;code class=&quot;language-text&quot;&gt;should&lt;/code&gt; 不存在. 所以此时应当如下所示使用.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; sould &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;chai&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;should&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;

should&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;not&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;exist&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;variable&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// variable 的值不应该是 null 或者 undefined&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;h2&gt;Mocha&lt;/h2&gt;
&lt;p&gt;现在我们来看看如何对 &lt;code class=&quot;language-text&quot;&gt;mocha&lt;/code&gt; 进行配置以及上手的步骤. 我假定在 &lt;code class=&quot;language-text&quot;&gt;mocha&lt;/code&gt; 中写测试的时候也同样需要使用 ES6 语法, 还有一个关注点是如果我在 &lt;code class=&quot;language-text&quot;&gt;webpack.config.js&lt;/code&gt; 中已经设置了 &lt;code class=&quot;language-text&quot;&gt;alias&lt;/code&gt;, 那么在写测试代码的时候, 我希望导入的文件也可以使用 &lt;code class=&quot;language-text&quot;&gt;alias&lt;/code&gt; 来保持我路径的一致性以及与此同时带来的便利性.&lt;/p&gt;
&lt;h3&gt;配置&lt;/h3&gt;
&lt;h4&gt;下载依赖&lt;/h4&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;npm install --save-dev mocha chai&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;接下来只要在项目根目录下新建文件夹 &lt;code class=&quot;language-text&quot;&gt;test&lt;/code&gt;, 在里面写的测试文件以 &lt;code class=&quot;language-text&quot;&gt;*.test.js&lt;/code&gt; 命名, 接下来在 &lt;code class=&quot;language-text&quot;&gt;packag.json&lt;/code&gt; 文件中 配置 &lt;code class=&quot;language-text&quot;&gt;npm test&lt;/code&gt; 命令.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;&amp;quot;npm test&amp;quot;: &amp;quot;./node_modules/.bin/mocha&amp;quot;&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;还可以在 &lt;code class=&quot;language-text&quot;&gt;test&lt;/code&gt; 根目录下新建一个配置文件 &lt;code class=&quot;language-text&quot;&gt;mocha.opts&lt;/code&gt;, 其中配置的选项相当于给 &lt;code class=&quot;language-text&quot;&gt;mocha&lt;/code&gt; 命令加入了命令行参数.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;--recursive
--ui bdd&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;具体的配置请参照文档 &lt;a href=&quot;http://mochajs.org/#usage&quot;&gt;Mocha - USAGE&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;之后在终端输入 &lt;code class=&quot;language-text&quot;&gt;npm run test&lt;/code&gt; 即可运行测试.&lt;/p&gt;
&lt;h4&gt;支持 ES6&lt;/h4&gt;
&lt;p&gt;上述只是配置好了基本的运行环境, 如果需要支持 ES6 的话, 那么还需要两个简单的步骤.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;npm install --save-dev babel-register&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;然后修改 &lt;code class=&quot;language-text&quot;&gt;mocha.opts&lt;/code&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;--recursive
--ui bdd
--require babel-register&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;完成, 现在已经支持 ES6 语法了.&lt;/p&gt;
&lt;h4&gt;支持 Webpack 的 Alias&lt;/h4&gt;
&lt;p&gt;如果不需要请跳过此步骤, 需要的推荐一个本人基于一个开源库修改的 babel 插件 &lt;a href=&quot;https://github.com/chengjianhua/babel-plugin-webpack-alias-resolve&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;babel-plugin-webpack-alias-resolve&lt;/code&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;h3&gt;写测试&lt;/h3&gt;
&lt;p&gt;直接上代码! 有一个对 &lt;code class=&quot;language-text&quot;&gt;axios&lt;/code&gt; 经过封装的 &lt;code class=&quot;language-text&quot;&gt;ajax&lt;/code&gt; 函数, 我现在对其进行测试. 下面是代码在 Gist 的地址 &lt;a href=&quot;https://gist.github.com/chengjianhua/08356304f95f477dba6f3cb977a6aa08&quot;&gt;the test for ajax which based on axios&lt;/a&gt;&lt;/p&gt;
&lt;h2&gt;结束&lt;/h2&gt;
&lt;p&gt;写的很少 … 正在实践当中, 其实测试上述那个文件的时候我已经踩了一些坑了, 但是写出来还是不够多, 等踩多了总结一下踩过的那些&lt;strong&gt;坑&lt;/strong&gt;.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[第一次的实习经验]]></title><description><![CDATA[…]]></description><link>https://chengjianhua.github.io/first-internship-experience/</link><guid isPermaLink="false">https://chengjianhua.github.io/first-internship-experience/</guid><pubDate>Tue, 25 Oct 2016 00:22:25 GMT</pubDate><content:encoded>&lt;p&gt;就在上个礼拜我结束了在北京的前端工程师实习回到了学校，现在正在学校休整中。在实习的这段时间内忙于各种事情也没有再写过一篇博客了，然而一个想成为优秀程序员的我怎么能放弃这样的自我总结机会呢！于是乎现在先写下过去这三个月的暑期实习的感受，从而也让自己清楚一下自己所处的状态。&lt;/p&gt;
&lt;!-- more --&gt;
&lt;h2&gt;一个和谐轻松的环境&lt;/h2&gt;
&lt;p&gt;在北京实习的这家公司是一个创业公司，公司总共 40 人左右。想到一开始就是在知乎上看到来的公司的招聘信息，点进去看到公司主页还挺像那么回事的，招聘信息还颇有情怀。然后　&lt;code class=&quot;language-text&quot;&gt;Ctrl + U&lt;/code&gt; 查看源代码，代码竟然有压缩，应该还是有前端的……（当时确实就是这么想的）后来很快就接到了电话面试，面试过程很轻松，leader 很随和。公司的技术栈和我在学校自学的几乎一致，不得不说也挺有缘。这次期间也没有收到别的面试，于是几天后就接受了这份实习。&lt;/p&gt;
&lt;p&gt;公司给我最大的感受就是自在，没有过多约束，不用打卡，没有办公室政治，大家也都是比较随和的人。我们前端部门的 leader 人真的特好，特好相处，也没有像传说中的那样让实习生做些简单的重复性劳动，我来了之后也挺放心的让我开始用 &lt;code class=&quot;language-text&quot;&gt;react&lt;/code&gt; 重构项目中的老代码。在这种氛围下，我也很随意，让同学觉得我都不像一个实习生该有的样子……只不过我觉得公司给我一个宽松的环境让我自由发挥，那我也就会付出相应的劳动，我相信自己这三个月下来还是给公司做出了我应有的贡献的。对于程序员来说我相信自由和宽松的环境更能激发自身的能力以及对技术本身的追求，在这样的环境下我有了时间可以摸索自己没有探索过的领域，更加深入了解 &lt;code class=&quot;language-text&quot;&gt;react&lt;/code&gt; 这门框架，写个具有些许复杂性的公用数据表组件给我带来了不少的成就感，这样的环境下才能不断提升自我。&lt;/p&gt;
&lt;h2&gt;时刻警惕舒适区&lt;/h2&gt;
&lt;p&gt;也因为我来公司之前就曾经自学过一段时间的 &lt;code class=&quot;language-text&quot;&gt;react&lt;/code&gt; 并且写出了一个简单的项目，所以我来了之后基本没有多少学习成本就开始直接上手工作了。一开始重构还能遇到很多的问题，但是随着重构继续进行，之后已经感觉到自己已经开始习惯了这样的方式重构代码了，就像写业务代码一样，没有新的挑战，就是按照一定的套路来实现。开始的过程中确实学到了不少，熟悉了 &lt;code class=&quot;language-text&quot;&gt;redux&lt;/code&gt; 和 &lt;code class=&quot;language-text&quot;&gt;react&lt;/code&gt; 的搭配使用，&lt;code class=&quot;language-text&quot;&gt;immutable&lt;/code&gt; 的常用用法以及对 &lt;code class=&quot;language-text&quot;&gt;JavaScript&lt;/code&gt; 本身的了解及使用技巧。后来我已经感觉到自己停留在舒适区没有过多进取，好吧，自己给自己找事。&lt;/p&gt;
&lt;p&gt;公司因为老架构的原因，没有整套上 &lt;code class=&quot;language-text&quot;&gt;webpack&lt;/code&gt;，还用着 &lt;code class=&quot;language-text&quot;&gt;gulp&lt;/code&gt; 处理 &lt;code class=&quot;language-text&quot;&gt;python&lt;/code&gt; 的 &lt;code class=&quot;language-text&quot;&gt;jinja2&lt;/code&gt; 模板。&lt;code class=&quot;language-text&quot;&gt;webpack&lt;/code&gt; 的配置也只是简单的打包，如果每次更改了 &lt;code class=&quot;language-text&quot;&gt;.jsx&lt;/code&gt; 组件代码之后，只要重新编译打包整个项目才能看到效果，想当初我自己写项目的时候用着的可是完善的热更新啊！好吧，那我就来搭建一套热更新的开发环境吧，经过几天的查找资料与学习，我搭建出来了一个简单的开发环境已经对应的生产环境配置。对编译打包做了些优化。此时没哟热更新（hmr）但是可以增量编译及自动刷新界面，经过一段时间的使用，leader 同意了我的代码提交并大家都开始使用这个开发环境。后来我进一步完善了这个配置，可以支持 &lt;code class=&quot;language-text&quot;&gt;hmr&lt;/code&gt;、&lt;code class=&quot;language-text&quot;&gt;source-map&lt;/code&gt;、&lt;code class=&quot;language-text&quot;&gt;hash 缓存方案&lt;/code&gt;…… 也是因为对自己的追求，最后说服 leader 我自己基于对一个开源框架 &lt;code class=&quot;language-text&quot;&gt;bootstrap-table&lt;/code&gt; 源码的阅读，开发了一个完全适用与我们公司定制的 &lt;code class=&quot;language-text&quot;&gt;DataTable&lt;/code&gt; 组件，这种类似造轮子的体验给我的体会就是：人嘛，要有追求一些，不能习惯于舒适的现状，要给自己多找机会（麻烦）学习！&lt;/p&gt;
&lt;h2&gt;前端，不能只是个 “前端”&lt;/h2&gt;
&lt;p&gt;我们前端的 leader 能写 &lt;code class=&quot;language-text&quot;&gt;docker&lt;/code&gt;、配 &lt;code class=&quot;language-text&quot;&gt;nginx&lt;/code&gt;、 改 &lt;code class=&quot;language-text&quot;&gt;Python&lt;/code&gt; 脚本 ……能自己正确搭出一套新架构的运行环境。这种状态是我对自己的理想状态，不是因此就是“不务正业”了，&lt;strong&gt;一专多长&lt;/strong&gt; 才是正道，当然我现在也只熟悉前端方向，但是其他方向的内容我们也应该了解，毕竟我们说到底还是个程序员，是个技术人员，没必要限死自己。在那之后我也是学会了一些简单的用法，我现在有个自己的域名，自己的服务器，在上面装上 &lt;code class=&quot;language-text&quot;&gt;docker&lt;/code&gt;、&lt;code class=&quot;language-text&quot;&gt;nginx&lt;/code&gt;，把自己的项目部署上去还是挺有意思的，接下来就是搭建一套简易的服务部署流程了，毕竟这么一段时间里一直在用 &lt;code class=&quot;language-text&quot;&gt;linux&lt;/code&gt; 系统。如果要给自己个定义，我认为我会是一名偏后端的前端工程师，我更喜欢用工具提升开发效率，喜欢对数据逻辑的处理以及工程化的实现相比实现样式效果而言。希望能有效地努力学习，加油！&lt;/p&gt;
&lt;h2&gt;自傲与虚心&lt;/h2&gt;
&lt;p&gt;身为一个程序员，我觉的但凡有些本事都会比较自傲，但是我在我 leader 的身上真的看到的很不一样，他很谦虚，很虚心接受别人的看法即使是我一个还没出学校的实习生，没有轻视，很平等的对待的感觉。让我一直有些许骄傲的心里波动了不少，自傲难以避免，我相信我心里永远会有这么一份傲气，但是虚心接受别人的观点和意见却是不冲突也是应该做到的。总怀着傲意难免使人目高于顶，眼高手低，这样当你被你自以为不如你的人打脸时想必会非常痛苦。谦虚使人进步！&lt;/p&gt;
&lt;h2&gt;基础知识真的很重要&lt;/h2&gt;
&lt;p&gt;别的不说，大公司的要求就是考察你的那些基础知识，&lt;strong&gt;操作系统&lt;/strong&gt;，&lt;strong&gt;计算机网络&lt;/strong&gt;，&lt;strong&gt;组成原理&lt;/strong&gt; 之类的。这些还真的很重要，除了大公司的要求之外，工作的时候发现对计算机网络的认识确实能帮助我们开发时更敏锐的察觉出一些问题，因此其他的那些基础知识真的很重要，真的能改变一个人的思考问题时的角度，过去被自己忽略的基础知识现在也该是捡起来的时候了。&lt;/p&gt;
&lt;h2&gt;BTW&lt;/h2&gt;
&lt;p&gt;自说自话也已经结束了，接下来能做的就是把这段时间里的对技术的了解以及总结写出来了。还有,实习公司真的很棒,&lt;em&gt;GeneDock&lt;/em&gt;!&lt;/p&gt;</content:encoded></item><item><title><![CDATA[使用 passport.js 来完成登录验证]]></title><description><![CDATA[先啰嗦一段背景 介绍一下项目所使用的技术栈。 ，使用   来完成后端服务器的架构，这个时候就遇到了一个问题了。在我以前，是用   来开发 Web…]]></description><link>https://chengjianhua.github.io/authenticate-by-passport/</link><guid isPermaLink="false">https://chengjianhua.github.io/authenticate-by-passport/</guid><pubDate>Wed, 22 Jun 2016 10:19:24 GMT</pubDate><content:encoded>&lt;p&gt;&lt;strong&gt;先啰嗦一段背景&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;介绍一下项目所使用的技术栈。&lt;code class=&quot;language-text&quot;&gt;Node.js&lt;/code&gt;，使用 &lt;code class=&quot;language-text&quot;&gt;Express&lt;/code&gt; 来完成后端服务器的架构，这个时候就遇到了一个问题了。在我以前，是用 &lt;code class=&quot;language-text&quot;&gt;Java&lt;/code&gt; 来开发 Web 后端服务器，那时我采用 &lt;code class=&quot;language-text&quot;&gt;Spring&lt;/code&gt; 框架来完成，登录的验证就是比对数据库中的用户名密码与当前用户所输入的用户名密码，而且如果希望拦截未登录的用户的访问某些特定的网址时，我可以添加 &lt;code class=&quot;language-text&quot;&gt;Spring&lt;/code&gt; 自定义的拦截器实现来实现用户未成功验证时的拦截。但是现在我使用的是 &lt;code class=&quot;language-text&quot;&gt;Node.js&lt;/code&gt; 来完成开发，不知道该怎么做了，没办法只好 google 一下了，结果推荐较多的就是 &lt;code class=&quot;language-text&quot;&gt;passport.js&lt;/code&gt; 。&lt;/p&gt;
&lt;p&gt;这个时候已经确定就使用这个 js 库了，好的，开工！但是问题来了，我该怎么使用呢，官方是有文档，英文倒也还好，但总感觉就是有那么点不够清晰，有些细节不一定能好好的解决，为了方便更多人使用这个框架，经过配置成功以后，想把这个的经验分享出来，&lt;strong&gt;好了，进入正题~&lt;/strong&gt;&lt;/p&gt;
&lt;!-- more --&gt;
&lt;h2&gt;配置环境&lt;/h2&gt;
&lt;h3&gt;使用的依赖包&lt;/h3&gt;
&lt;p&gt;默认使用的环境就是 &lt;code class=&quot;language-text&quot;&gt;express&lt;/code&gt; 搭建的服务器。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# passport 需要 session 的支持，&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;#由于使用的是 express.js，所以这里使用 express-session&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;npm&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; express-session --save

&lt;span class=&quot;token comment&quot;&gt;# 当然要下载 passport ……&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;npm&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; passport --save

&lt;span class=&quot;token comment&quot;&gt;# passport支持一系列的 OAuth 第三方验证，&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;#而我们一般的使用场景为验证自己项目中的用户&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;#，所以这里使用 passport-local&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;npm&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; passport-local --save
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;h3&gt;配置服务器&lt;/h3&gt;
&lt;p&gt;先搭建好服务器用于 &lt;code class=&quot;language-text&quot;&gt;passport&lt;/code&gt; 的配置，加上 &lt;code class=&quot;language-text&quot;&gt;session&lt;/code&gt; 的配置，其中 &lt;code class=&quot;language-text&quot;&gt;passport-config.js&lt;/code&gt; 文件先导入不管具体实现，不影响我的描述，稍后将在下方给出详细配置方法。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;/**
 * /server.js
 */&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; express &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;express&apos;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; expressSession &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;express-session&apos;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// 导入一个我们配置好了 passport 的 js 文件&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; passport &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;../core/passport-config&apos;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; server &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;express&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// ... 不相干的 express 的配置&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// 配置 session，passport 所需的基础，必须有&lt;/span&gt;
server&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;use&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;expressSession&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// 你喜欢的任意名字作为一个加密用的字符串&lt;/span&gt;
    secret&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;whatever the name you like&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    resave&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    saveUninitialized&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// 初始化调用 passport&lt;/span&gt;
server&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;use&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;passport&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;initialize&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
server&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;use&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;passport&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;session&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;//&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;到这里为止，我们在服务器上的设置就完成了，接下来看看如何配置 &lt;code class=&quot;language-text&quot;&gt;passport&lt;/code&gt;。&lt;/p&gt;
&lt;h3&gt;配置 passport.js&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;我把代码的作用写在了以下代码的注释中&lt;/strong&gt;，里面详细讲述了大致的原理及作用。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;/**
 * /core/passport-config.js
 */&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; passport &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;passport&apos;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; LocalStrategy &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;passport-local&apos;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// 这里引入的是一个操作数据库的 User 工具函数&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; User &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;../model/User&apos;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// 这个配置就是参照官方示例来的，不过官方的讲解不够详细&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// 我将在这里详细讲讲是怎样获取用户并验证是否正确&lt;/span&gt;
passport&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;use&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;LocalStrategy&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;/**
     * @param username 用户输入的用户名
     * @param password 用户输入的密码
     * @param done 验证验证完成后的回调函数，由passport调用
     */&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;username&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; password&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; done&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token comment&quot;&gt;// 在编写 User.findUniqueUserByUsername 时，包含两个参数，一个是 username&lt;/span&gt;
      &lt;span class=&quot;token comment&quot;&gt;// 一个是我们现在所传入的回调函数，我们将获取到的用户信息传递给我们的回调函数&lt;/span&gt;
      User&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;findUniqueUserByUsername&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;username&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;err&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; user&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;err&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
          console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;出现错误.&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
          &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;done&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;err&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;user&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
          console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;没有找到对应的用户名.&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

          &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;done&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; message&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;没有找到对应的用户名.&apos;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;user&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;password &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; password&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
          console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;密码匹配有误.&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

          &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;done&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; message&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;密码匹配有误.&apos;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;done&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; user&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// serializeUser 在用户登录验证成功以后将会把用户的数据存储到 session 中（在这里&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// 存到 session 中的是用户的 username）。在这里的 user 应为我们之前在 new&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// LocalStrategy (fution() { ... }) 中传递到回调函数 done 的参数 user 对象（从数据// 库中获取到的）&lt;/span&gt;
passport&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;serializeUser&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;user&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; done&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;done&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; user&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;username&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// deserializeUser 在每次请求的时候将会根据用户名读取 从 session 中读取用户的全部数据&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// 的对象，并将其封装到 req.user&lt;/span&gt;
passport&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;deserializeUser&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;username&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; done&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  User&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;findUniqueUserByUsername&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;username&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;err&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; user&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;err&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;done&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;err&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;done&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; user&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// 这是封装了一个中间件函数到 passport 中，可以在需要拦截未验证的用户的请求的时候调用&lt;/span&gt;
passport&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function-variable function&quot;&gt;authenticateMiddleware&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;authenticationMiddleware&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;req&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; res&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; next&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;req&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;isAuthenticated&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;next&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    res&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;redirect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;/login&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;default&lt;/span&gt; passport
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;到此基本的配置到此结束，以我的经验，这足以来完成基本的验证使用了。&lt;/p&gt;
&lt;h2&gt;使用&lt;/h2&gt;
&lt;p&gt;接下来讲讲如何在 &lt;em&gt;server.js&lt;/em&gt; 中使用我们上面配置好的 &lt;em&gt;passport.js&lt;/em&gt;， 我们在 &lt;strong&gt;配置服务器&lt;/strong&gt; 中已经加载并使用了我们的配置，现在让我们看看如何在我们的路由中使用它。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// ------------&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// server.js&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// ------------&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; passport &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;../core/passport-config&apos;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// 如下所示，我们在路由的请求地址 “/login” 和 后续的请求处理函数之间调用&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// passport.authenticate(&apos;local&apos;)，即可完成对用户输入的用户名密码的验证&lt;/span&gt;
server&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;post&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;/login&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; passport&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;authenticate&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;local&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;req&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; res&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// req.user 中会包含在 deserializeUser 函数中传入的 user 数据&lt;/span&gt;
  console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;-------req.user-----------&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;req&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;user&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;-------req.user-----------&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; returnData &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    isSuccess&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    uer&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; req&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;user&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  res&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;send&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;JSON&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;stringify&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;returnData&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// 调用我们之前在 passport-config 中封装的用于验证用户是否已经被验证的中间件函数&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// 即可限制未被验证的用户不能请求该路由，返回 Error: 401(Unauthorized)&lt;/span&gt;
server&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;/testAuth&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; passport&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;authenticateMiddleware&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;req&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; res&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// ......&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;h2&gt;总结&lt;/h2&gt;
&lt;p&gt;经过实例代码我们知道了如何配置以及使用 passport。解释内容请读者留心代码注释。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[border 的使用指南及有趣的应用]]></title><description><![CDATA[这是我们经常使用边框时写的代码，接下来清清楚楚的讲讲边框的详细设置，之后拓展一些有趣的应用。 属性设置 border-width  的宽度设置上下左右时是按照顺时针方向来的，方便记忆（自从按照顺时针来记忆，所有的相关的  、   等等的宽度设置我都记住了，作为新手的一个小 tip…]]></description><link>https://chengjianhua.github.io/border-usage/</link><guid isPermaLink="false">https://chengjianhua.github.io/border-usage/</guid><pubDate>Wed, 25 May 2016 01:03:26 GMT</pubDate><content:encoded>&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-css&quot;&gt;&lt;code class=&quot;language-css&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;/* 1像素单位宽度的实心边框 */&lt;/span&gt;
&lt;span class=&quot;token property&quot;&gt;border&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 1px solid #000&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;这是我们经常使用边框时写的代码，接下来清清楚楚的讲讲边框的详细设置，之后拓展一些有趣的应用。&lt;/p&gt;
&lt;!-- more --&gt;
&lt;h2&gt;属性设置&lt;/h2&gt;
&lt;h3&gt;border-width&lt;/h3&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;border&lt;/code&gt; 的宽度设置上下左右时是按照顺时针方向来的，方便记忆（自从按照顺时针来记忆，所有的相关的 &lt;code class=&quot;language-text&quot;&gt;margin&lt;/code&gt;、 &lt;code class=&quot;language-text&quot;&gt;padding&lt;/code&gt; 等等的宽度设置我都记住了，作为新手的一个小 tip ）。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-css&quot;&gt;&lt;code class=&quot;language-css&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;/* border-width: width */&lt;/span&gt;
&lt;span class=&quot;token property&quot;&gt;border-width&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 5px&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;/* vertical | horizontal */&lt;/span&gt;
&lt;span class=&quot;token property&quot;&gt;border-width&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 2px 1.5em&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;/* top | horizontal | bottom */&lt;/span&gt;
&lt;span class=&quot;token property&quot;&gt;border-width&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 1px 2em 1.5cm&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;/* top | right | bottom | left */&lt;/span&gt;
&lt;span class=&quot;token property&quot;&gt;border-width&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 1px 2em 0 4rem&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token property&quot;&gt;border-width&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; inherit&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;h3&gt;border-style&lt;/h3&gt;
&lt;p&gt;这个属性的设置是用来设置边框的样式，例如常用的 &lt;code class=&quot;language-text&quot;&gt;solid（实线）&lt;/code&gt;、 &lt;code class=&quot;language-text&quot;&gt;dashed（虚线）&lt;/code&gt;等等。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-css&quot;&gt;&lt;code class=&quot;language-css&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;/* 边框的样式将为虚线状 */&lt;/span&gt;
&lt;span class=&quot;token property&quot;&gt;border-style&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; dashed&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;h3&gt;border-color&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-css&quot;&gt;&lt;code class=&quot;language-css&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;/* 边框的颜色将变为黑色 */&lt;/span&gt;
&lt;span class=&quot;token property&quot;&gt;border-color&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; #000&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;设置边框的颜色（大家都知道，废话什么……），不过在网上学到了一个使用的小技巧与设置边框的颜色有关，待会在下面说明。&lt;/p&gt;
&lt;h3&gt;border-radius&lt;/h3&gt;
&lt;h2&gt;应用&lt;/h2&gt;
&lt;iframe height=&apos;431&apos; scrolling=&apos;no&apos; src=&apos;//codepen.io/chengjianhua/embed/aNeaRR/?height=431&amp;theme-id=dark&amp;default-tab=css,result&amp;embed-version=2&apos; frameborder=&apos;no&apos; allowtransparency=&apos;true&apos; allowfullscreen=&apos;true&apos; style=&apos;width: 100%;&apos;&gt;See the Pen &lt;a href=&apos;http://codepen.io/chengjianhua/pen/aNeaRR/&apos;&gt;border-radius handbook and usage&lt;/a&gt; by Cheng Jianhua (&lt;a href=&apos;http://codepen.io/chengjianhua&apos;&gt;@chengjianhua&lt;/a&gt;) on &lt;a href=&apos;http://codepen.io&apos;&gt;CodePen&lt;/a&gt;.
&lt;/iframe&gt;
&lt;h2&gt;总结&lt;/h2&gt;
&lt;p&gt;接下来让我强行总结一番。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[React 中 context 的使用]]></title><description><![CDATA[…]]></description><link>https://chengjianhua.github.io/react-context/</link><guid isPermaLink="false">https://chengjianhua.github.io/react-context/</guid><pubDate>Tue, 24 May 2016 01:02:13 GMT</pubDate><content:encoded>&lt;p&gt;&lt;a href=&quot;https://facebook.github.io/react/docs/context.html&quot;&gt;官方文档说明（英）&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;看了别人写的中文博客，再看了官方英文文档，发现还是官方文档讲的浅显易懂一些，看了之后，半翻译半理解地写了这篇博客，更易于新手理解。&lt;/p&gt;
&lt;h2&gt;介绍&lt;/h2&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;context&lt;/code&gt; 是在 &lt;code class=&quot;language-text&quot;&gt;react @ 0.14&lt;/code&gt; 版本以后发布的一个高级且实验性的功能，有可能在未来做出更改。不推荐频繁使用，如果使用的话尽量保持在小范围内并且避免直接使用 &lt;code class=&quot;language-text&quot;&gt;context&lt;/code&gt; 的 API，为了以后升级框架更加容易。&lt;/p&gt;
&lt;h2&gt;使用 Context 的原因&lt;/h2&gt;
&lt;p&gt;为了有时候想传递数据通过组件树，但是不想给每一层级的组件手动传递属性，那么 &lt;code class=&quot;language-text&quot;&gt;context&lt;/code&gt; 就能帮你 &lt;strong&gt;“越级”&lt;/strong&gt; 传递数据到组件树中你想传递到的深层次组件。&lt;/p&gt;
&lt;p&gt;有时候 &lt;code class=&quot;language-text&quot;&gt;A组件&lt;/code&gt; 为了给 &lt;code class=&quot;language-text&quot;&gt;B组件&lt;/code&gt; 中的 &lt;code class=&quot;language-text&quot;&gt;C组件&lt;/code&gt; 传递一个 &lt;code class=&quot;language-text&quot;&gt;prop&lt;/code&gt; ，而需要把参数在组件中传递两次才能最终将 &lt;code class=&quot;language-text&quot;&gt;A组件&lt;/code&gt; 中的 &lt;code class=&quot;language-text&quot;&gt;prop&lt;/code&gt; 传递给 &lt;code class=&quot;language-text&quot;&gt;C组件&lt;/code&gt;。&lt;/p&gt;
&lt;!-- more --&gt;
&lt;p&gt;官方文档的示例代码如下&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; Button &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; React&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;createClass&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  render&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
      &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;button style&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; background&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;color &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;children&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;button&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; Message &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; React&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;createClass&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  render&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
      &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;div&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;text&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Button color&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;color&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;Delete&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;Button&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
      &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;div&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; MessageList &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; React&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;createClass&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  render&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; color &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;purple&apos;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; children &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;messages&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;message&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Message text&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;message&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;text&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; color&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;color&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;div&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;children&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;div&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;h2&gt;使用 context 改进数据传递&lt;/h2&gt;
&lt;p&gt;现在我们使用 &lt;code class=&quot;language-text&quot;&gt;context&lt;/code&gt; 来完成参数的传递试试&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; Button &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; React&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;createClass&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// 必须指定context的数据类型&lt;/span&gt;
  contextTypes&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    color&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; React&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;PropTypes&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;string&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  render&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
      &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;button style&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; background&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;color &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;children&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;button&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; Message &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; React&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;createClass&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  render&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
      &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;div&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;text&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Button&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;Delete&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;Button&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
      &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;div&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; MessageList &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; React&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;createClass&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;//&lt;/span&gt;
  childContextTypes&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    color&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; React&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;PropTypes&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;string&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  getChildContext&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; color&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;purple&apos;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  render&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; children &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;messages&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;message&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Message text&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;message&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;text&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;div&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;children&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;div&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;示例代码中通过添加 &lt;code class=&quot;language-text&quot;&gt;childContextTypes&lt;/code&gt; 和 &lt;code class=&quot;language-text&quot;&gt;getChildContext()&lt;/code&gt; 到 &lt;code class=&quot;language-text&quot;&gt;MessageList&lt;/code&gt; （&lt;code class=&quot;language-text&quot;&gt;context&lt;/code&gt; 的提供者），React 自动向下传递数据然后在组件树中的任意组件（也就是说任意子组件，在此示例代码中也就是 &lt;code class=&quot;language-text&quot;&gt;Button&lt;/code&gt;）都能通过定义 &lt;code class=&quot;language-text&quot;&gt;contextTypes&lt;/code&gt; 访问 &lt;code class=&quot;language-text&quot;&gt;context&lt;/code&gt; 中的数据。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;总结：&lt;/strong&gt; 指定数据并要将数据传递下去的父组件要定义 &lt;code class=&quot;language-text&quot;&gt;childContextTypes&lt;/code&gt; 和 &lt;code class=&quot;language-text&quot;&gt;getChildContext()&lt;/code&gt;；想要接收到数据的子组件 &lt;strong&gt;必须定义&lt;/strong&gt; &lt;code class=&quot;language-text&quot;&gt;contextTypes&lt;/code&gt; 来使用传递过来的 &lt;code class=&quot;language-text&quot;&gt;context&lt;/code&gt;。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[设置 SSH 使用 hexo deploy 时免输用户名密码]]></title><description><![CDATA[此篇博客日期  ，使用  。介绍清楚这个使用背景是因为网上的有些教程已经过时，至少当我完全按照那些步骤来设置的时候并没有成功。SSH…]]></description><link>https://chengjianhua.github.io/hexo-deploy-without-pw-by-ssh/</link><guid isPermaLink="false">https://chengjianhua.github.io/hexo-deploy-without-pw-by-ssh/</guid><pubDate>Sat, 14 May 2016 16:29:35 GMT</pubDate><content:encoded>&lt;p&gt;此篇博客日期 &lt;code class=&quot;language-text&quot;&gt;2016-05-14&lt;/code&gt;，使用 &lt;code class=&quot;language-text&quot;&gt;hexo v0.2.0&lt;/code&gt;。介绍清楚这个使用背景是因为网上的有些教程已经过时，至少当我完全按照那些步骤来设置的时候并没有成功。SSH 验证就是我们键入命令 &lt;code class=&quot;language-text&quot;&gt;hexo deploy&lt;/code&gt; 以后，当那些需要提交的内容显示完成过后会弹出的一个小窗口提示我们输入用户名、密码。我参考了网上的一些教程，现在给出完整可行的教程，let’s do it！&lt;/p&gt;
&lt;!-- more --&gt;
&lt;h2&gt;生成 SSH 密钥&lt;/h2&gt;
&lt;p&gt;首先打开命令行工具，通常我们可以直接右键鼠标任意位置打开 &lt;code class=&quot;language-text&quot;&gt;Git Bash Here&lt;/code&gt;，然后输入以下命令&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-cmd&quot;&gt;&lt;code class=&quot;language-cmd&quot;&gt;$ cd ~/.ssh
# Checks to see if there is a directory named &amp;quot;.ssh&amp;quot; in your user directory&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;使用 &lt;code class=&quot;language-text&quot;&gt;ssh-keygen&lt;/code&gt; 生成密钥&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-cmd&quot;&gt;&lt;code class=&quot;language-cmd&quot;&gt;$ ssh-keygen -t rsa -C &amp;quot;your_email@example.com&amp;quot;
# Creates a new ssh key using the provided email
Generating public/private rsa key pair.
Enter file in which to save the key (/home/you/.ssh/id_rsa):&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;使用默认的文件名直接 enter，接下来显示如下&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-cmd&quot;&gt;&lt;code class=&quot;language-cmd&quot;&gt;Enter passphrase (empty for no passphrase): [Type a passphrase]
Enter same passphrase again: [Type passphrase again]&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;按提示输入密码即可（简化流程的话在键入命令 &lt;code class=&quot;language-text&quot;&gt;ssh-keygen -t rsa -C &amp;quot;your_email@example.com&amp;quot;&lt;/code&gt; 以后的三次提示输入都可以直接回车跳过）。&lt;/p&gt;
&lt;p&gt;密钥生成成功&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-cmd&quot;&gt;&lt;code class=&quot;language-cmd&quot;&gt;Your identification has been saved in /home/you/.ssh/id_rsa.
Your public key has been saved in /home/you/.ssh/id_rsa.pub.
The key fingerprint is:
…………………此处是密钥内容…………………… your_email@example.com&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;h2&gt;设置 Github 项目的 Deploy keys&lt;/h2&gt;
&lt;p&gt;可以选择是在用户设置中添加密钥（Settings —&gt; SSH GPG keys）还是单个项目中添加密钥，在这里我就在我们的博客项目中添加密钥，此处以我的博客为例。在 &lt;code class=&quot;language-text&quot;&gt;chengjianhua.github.io&lt;/code&gt; 的首页菜单栏中点击 &lt;strong&gt;Settings —&gt; Deploy keys —&gt; Add deploy key&lt;/strong&gt;，然后将生成的 &lt;code class=&quot;language-text&quot;&gt;id_rsa.pub&lt;/code&gt; 中的内容全选复制到 &lt;strong&gt;key&lt;/strong&gt; 输入框中，然后点击 &lt;strong&gt;Add key&lt;/strong&gt; 完成添加公钥。&lt;/p&gt;
&lt;p&gt;接下来测试配置是否成功&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-cmd&quot;&gt;&lt;code class=&quot;language-cmd&quot;&gt;$ ssh -T git@github.com&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;如果出现以下内容即表示配置完成并且成功！&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-cmd&quot;&gt;&lt;code class=&quot;language-cmd&quot;&gt;Hi username! You&amp;#39;ve successfully authenticated, but GitHub does not
provide shell access.&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;h2&gt;设置博客的提交地址&lt;/h2&gt;
&lt;p&gt;到了这一个步骤和大家在网上搜到的其他教程就不一样了，网上的这一步就是设置&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-cmd&quot;&gt;&lt;code class=&quot;language-cmd&quot;&gt;# 切入到包含 .git 文件夹的文件夹
$ cd .deploy/

# 查看当前的传输协议
$ git remote -v

origin  https://github.com/USERNAME/REPOSITORY.git (fetch)
origin  https://github.com/USERNAME/REPOSITORY.git (push)

# 修改 https 协议为 ssh 协议
$ git remote set-url origin git@github.com:USERNAME/REPOSITORY2.git&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;但是我根据网上的并没有用。更别提我的 blog 文件夹中包含 &lt;code class=&quot;language-text&quot;&gt;.git&lt;/code&gt; 文件夹的文件夹（好绕啊……）名字是 &lt;code class=&quot;language-text&quot;&gt;.deploy_git&lt;/code&gt; 了。还有我输入 &lt;code class=&quot;language-text&quot;&gt;$ git remote -v&lt;/code&gt; 时的显示结果为空，我尝试过自己添加 &lt;code class=&quot;language-text&quot;&gt;$ git remote add origin git@github.com:chengjianhua/chengjianhua.github.io.git&lt;/code&gt;,然后 &lt;code class=&quot;language-text&quot;&gt;$ hexo deploy&lt;/code&gt; 还是需要输入密码。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;解决办法出来了！&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;在 &lt;code class=&quot;language-text&quot;&gt;hexo deploy&lt;/code&gt; 的控制台输出结果中我看到了链接仍然是 &lt;code class=&quot;language-text&quot;&gt;https&lt;/code&gt; 的链接，这时我想到了 &lt;code class=&quot;language-text&quot;&gt;hexo&lt;/code&gt; 的配置文件 &lt;code class=&quot;language-text&quot;&gt;_config.yml&lt;/code&gt; 中的 &lt;code class=&quot;language-text&quot;&gt;deploy&lt;/code&gt; 属性。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;deploy&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;
  type&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; git
  repo&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; git@github.com&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;chengjianhua/chengjianhua.github.io.git
  branch&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; master
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;我将其中的 &lt;code class=&quot;language-text&quot;&gt;repo&lt;/code&gt;修改成了&lt;code class=&quot;language-text&quot;&gt;git@github.com:chengjianhua/chengjianhua.github.io.git&lt;/code&gt;，这个时候我再尝试了 &lt;code class=&quot;language-text&quot;&gt;$ hexo deploy&lt;/code&gt; 果然成功了，就不用输入密码了！&lt;/p&gt;
&lt;p&gt;到此我的解决方法已经完成了，希望能帮到使用 &lt;code class=&quot;language-text&quot;&gt;hexo&lt;/code&gt; 的同学们~&lt;/p&gt;</content:encoded></item><item><title><![CDATA[自定义Atom编辑器的样式]]></title><description><![CDATA[Atom 自定义样式 Atom 作为新一代的文本编辑器，插件丰富，可定制化程度高。之前还没意识到这点，这次简单的实践了一下才体会到了。之前看着左侧的 “Tree View…]]></description><link>https://chengjianhua.github.io/atom-custom-style/</link><guid isPermaLink="false">https://chengjianhua.github.io/atom-custom-style/</guid><pubDate>Thu, 12 May 2016 18:11:08 GMT</pubDate><content:encoded>&lt;h1&gt;Atom 自定义样式&lt;/h1&gt;
&lt;p&gt;Atom 作为新一代的文本编辑器，插件丰富，可定制化程度高。之前还没意识到这点，这次简单的实践了一下才体会到了。之前看着左侧的 “Tree View” 中的中文字体的显示默认为宋体，由于宋体显示的样子就是点阵式的样子，显得特别不和谐，锯齿感很严重，怎么看都不舒服，MarkDown 的预览界面也是如此，今天就把这两个字体都替换了一下，统一成“Microsoft YaHei”，心情舒畅了！&lt;/p&gt;
&lt;!-- more --&gt;
&lt;p&gt;我们先要知道，因为 Atom 就是个使用浏览器内核编写的文本编辑器，所以一整个编辑器都能当作一个浏览器来看。所以我们能够使用 CSS 来定义样式，甚至还能通过打开开发者模式来审查元素（&lt;strong&gt;View —&gt; Developer —&gt; Open In Dev Mode&lt;/strong&gt;）。所以接下来就让我们打开自定义样式表来修改我们想要的样子吧（&lt;strong&gt;File —&gt; Stylesheet&lt;/strong&gt;）。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xs7xr.com1.z0.glb.clouddn.com/atom-stylesheet.png&quot; alt=&quot;atom-stylesheet&quot;&gt;&lt;/p&gt;
&lt;h1&gt;Tree View&lt;/h1&gt;
&lt;p&gt;&lt;img src=&quot;http://7xs7xr.com1.z0.glb.clouddn.com/old-tree-view.png&quot; alt=&quot;Tree View 修改前的样子&quot;&gt;&lt;/p&gt;
&lt;p&gt;接下来让我们修改我们之前在样式表中看到的如下代码改成我们期望的&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-css&quot;&gt;&lt;code class=&quot;language-css&quot;&gt;&lt;span class=&quot;token selector&quot;&gt;.tree-view&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  // &lt;span class=&quot;token property&quot;&gt;background-color&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; whitesmoke&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;我们添加一个 &lt;code class=&quot;language-text&quot;&gt;font-maily&lt;/code&gt; 属性，并设置我们想要的字体&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-css&quot;&gt;&lt;code class=&quot;language-css&quot;&gt;&lt;span class=&quot;token selector&quot;&gt;.tree-view&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  // &lt;span class=&quot;token property&quot;&gt;background-color&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; whitesmoke&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;font-family&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Segoe UI, Microsoft YaHei&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;&lt;strong&gt;注意：&lt;/strong&gt; 设置字体的时候有个技巧，如果设置字体的时候设置两个以上的字体的话，如上我们设置的。第一个字体将用于显示 &lt;strong&gt;西文&lt;/strong&gt; 字体（英文字母、英文标点、阿拉伯数字……），然后遇到汉字之类不受第一个字体支持的字符集就按顺序使用第二个字体。所以 &lt;strong&gt;通常我们可以使用这个特性来完成分别设定英文、中文字体。&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;设置完成的效果如下&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xs7xr.com1.z0.glb.clouddn.com/new-tree-view.png&quot; alt=&quot;设置后的tree view显示效果&quot;&gt;&lt;/p&gt;
&lt;p&gt;是不是看起来舒畅了许多，拯救强迫症！&lt;/p&gt;
&lt;h1&gt;MarkDown Preview&lt;/h1&gt;
&lt;p&gt;我就不贴对比图了，但是这里有个小坑。当你使用审查元素得知 markdown-preview 界面的内容是被包裹在一个 &lt;code class=&quot;language-text&quot;&gt;&amp;lt;div class=&amp;quot;markdown-preview&amp;quot;&amp;gt; &amp;lt;/div&amp;gt;&lt;/code&gt; 中的时候，你会直接想设置 &lt;code class=&quot;language-text&quot;&gt;.markdown-preview {font-family: Segoe UI ,Microsoft YaHei;}&lt;/code&gt;，但是无效，我也不知道原因，但是在 Github 上找到了解决方案，如下所示&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-css&quot;&gt;&lt;code class=&quot;language-css&quot;&gt;&lt;span class=&quot;token selector&quot;&gt;.markdown-preview.markdown-preview&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;font-family&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;Segoe UI&apos;&lt;/span&gt;, &lt;span class=&quot;token string&quot;&gt;&apos;Microsoft YaHei&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;这样就完成了，接下来给一张完成后的效果图&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xs7xr.com1.z0.glb.clouddn.com/mardown-preview-font-be-customized.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;送给不喜欢宋体的同学们，更多小技巧再挖掘。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[WebSocket 原理]]></title><description><![CDATA[背景 以前的网站为了实现 推送 功能，使用的方法都是 轮询 。所谓的轮询就是在特定的时间间隔（例如…]]></description><link>https://chengjianhua.github.io/websocket-theory/</link><guid isPermaLink="false">https://chengjianhua.github.io/websocket-theory/</guid><pubDate>Thu, 12 May 2016 10:43:12 GMT</pubDate><content:encoded>&lt;h2&gt;背景&lt;/h2&gt;
&lt;p&gt;以前的网站为了实现&lt;strong&gt;推送&lt;/strong&gt;功能，使用的方法都是&lt;strong&gt;轮询&lt;/strong&gt;。所谓的轮询就是在特定的时间间隔（例如 1 秒），由浏览器向服务器发出一个 &lt;code class=&quot;language-text&quot;&gt;Http request&lt;/code&gt;，然后服务器返回最新的数据给客户端浏览器，从而给出一种服务端实时推送的假象。由于&lt;code class=&quot;language-text&quot;&gt;Http Request&lt;/code&gt;的&lt;code class=&quot;language-text&quot;&gt;Header&lt;/code&gt;（请求头）很长,而传输的数据可能很短就只占一点点，每次请求消耗的带宽大部分都消耗在 &lt;code class=&quot;language-text&quot;&gt;Header&lt;/code&gt;上。从网上资料得知后来还有改进的轮询方法叫做 &lt;code class=&quot;language-text&quot;&gt;Comet&lt;/code&gt;，使用 &lt;code class=&quot;language-text&quot;&gt;Ajax&lt;/code&gt;。但这种技术虽然可达到双向通信，但依然需要发出请求，而且在 Comet 中，普遍采用了长链接，这也会大量消耗服务器带宽和资源。&lt;/p&gt;
&lt;p&gt;所以 HTML5 定义了 &lt;code class=&quot;language-text&quot;&gt;WebSocket&lt;/code&gt; 协议，以及相关的编程 API，能更好的实现双向通信且节省服务器资源和带宽。&lt;/p&gt;
&lt;!-- more --&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;注意&lt;/strong&gt;： &lt;code class=&quot;language-text&quot;&gt;WebSocket&lt;/code&gt; 实际上指的是一种协议，与我们熟知的 &lt;code class=&quot;language-text&quot;&gt;Http&lt;/code&gt; 协议是同等的一个网络协议。用网络模型结构来解释的话， &lt;code class=&quot;language-text&quot;&gt;WebSocket&lt;/code&gt; 和 &lt;code class=&quot;language-text&quot;&gt;Http&lt;/code&gt; 协议都属于 &lt;code class=&quot;language-text&quot;&gt;应用层协议&lt;/code&gt;，两者都基于传输层协议 &lt;code class=&quot;language-text&quot;&gt;TCP&lt;/code&gt;。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2&gt;WebSocket 协议&lt;/h2&gt;
&lt;h3&gt;与 HTML5 的联系&lt;/h3&gt;
&lt;p&gt;Html5 是指的一系列新的 API，或者说新规范，新技术。在这个新规范中定义了一个为了实现双向实时通信的新协议 &lt;code class=&quot;language-text&quot;&gt;WebSocket&lt;/code&gt;，并且提供了一套 JavaScript API 供开发者来调用实现通信。服务器端的实现由诸如：Tomcat、Jetty 等等。&lt;/p&gt;
&lt;h3&gt;与 Http 协议的联系&lt;/h3&gt;
&lt;p&gt;简单概括来看： &lt;code class=&quot;language-text&quot;&gt;WebSocket&lt;/code&gt; 不是 &lt;code class=&quot;language-text&quot;&gt;Http&lt;/code&gt; 协议， &lt;code class=&quot;language-text&quot;&gt;Http&lt;/code&gt; 协议只是被 &lt;code class=&quot;language-text&quot;&gt;WebSocket&lt;/code&gt; 使用来建立 &lt;code class=&quot;language-text&quot;&gt;WebSocket&lt;/code&gt; 连接，连接建立了以后客户端与服务器的双向通信就与 &lt;code class=&quot;language-text&quot;&gt;Http&lt;/code&gt; 无关了。&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;WebSocket&lt;/code&gt; 协议和 &lt;code class=&quot;language-text&quot;&gt;HTTP&lt;/code&gt; 协议是两种不同的东西，它们的联系如下：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;客户端开始建立 WebSocket 连接时要发送一个 header 标记了 Upgrade 的 HTTP 请求，表示请求协议升级。所以服务器端做出响应的简便方法是，直接在现有的 HTTP 服务器软件和现有的端口上实现 WebSocket 协议，重用现有代码（比如解析和认证这个 HTTP 请求。如果在 TCP 协议上实现，这两个功能就要重新实现），然后再回一个状态码为 101 的 HTTP 响应完成握手，再往后发送数据时就没 HTTP 的事了。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;作者：长天之云链接：&lt;a href=&quot;https://www.zhihu.com/question/20215561/answer/14365823&quot;&gt;https://www.zhihu.com/question/20215561/answer/14365823&lt;/a&gt;
来源：知乎著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3&gt;例子&lt;/h3&gt;
&lt;p&gt;下面给出发出建立连接请求时的 &lt;code class=&quot;language-text&quot;&gt;request&lt;/code&gt; 和 &lt;code class=&quot;language-text&quot;&gt;response&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;注意：下面的请求报文与响应报文中的内容不是完整的报文，而是 &lt;code class=&quot;language-text&quot;&gt;WebSocket&lt;/code&gt; 基于 &lt;code class=&quot;language-text&quot;&gt;Http&lt;/code&gt; 请求（响应）报文添加的内容。&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;浏览器请求&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-html&quot;&gt;&lt;code class=&quot;language-html&quot;&gt;GET / HTTP/1.1
Upgrade: websocket
Connection: Upgrade
Host: example.com
Origin: null
Sec-WebSocket-Key: sN9cRrP/n9NdMgdcy2VJFQ==
Sec-WebSocket-Version: 13
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;服务器回应&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-html&quot;&gt;&lt;code class=&quot;language-html&quot;&gt;HTTP/1.1 101 Switching Protocols
Upgrade: websocket
Connection: Upgrade
Sec-WebSocket-Accept: fFBooB7FAkLlXgRSz0BT3v4hq5s=
Sec-WebSocket-Origin: null
Sec-WebSocket-Location: ws://example.com/
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;</content:encoded></item><item><title><![CDATA[使用 WebUploader 解决安卓微信浏览器上传图片中遇到的 bug]]></title><description><![CDATA[微信浏览器上传图片 bug 的原因 微信在新版本中采用的是自己的 X5 内核浏览器，而在较老的版本中还有可能是安卓的原生浏览器。具体的环境我也不太了解，但是经过实际多台安卓机型的测试，我采取的方案可以基本确保在安卓机中微信浏览器的成功上传。苹果机型没问题，因为微信的 ios…]]></description><link>https://chengjianhua.github.io/webuploader-usage-review/</link><guid isPermaLink="false">https://chengjianhua.github.io/webuploader-usage-review/</guid><pubDate>Sat, 09 Apr 2016 02:03:31 GMT</pubDate><content:encoded>&lt;h1&gt;微信浏览器上传图片 bug 的原因&lt;/h1&gt;
&lt;p&gt;微信在新版本中采用的是自己的 X5 内核浏览器，而在较老的版本中还有可能是安卓的原生浏览器。具体的环境我也不太了解，但是经过实际多台安卓机型的测试，我采取的方案可以基本确保在安卓机中微信浏览器的成功上传。苹果机型没问题，因为微信的 ios 客户端使用的是 Safari 的内核，没有各种坑，且效果最好。&lt;/p&gt;
&lt;!-- more --&gt;
&lt;p&gt;这里给出一个 &lt;code class=&quot;language-text&quot;&gt;WebUploader&lt;/code&gt; 官方关于移动端适配的 &lt;a href=&quot;https://github.com/fex-team/webuploader/issues/185&quot;&gt;issues&lt;/a&gt; 链接。里面提供的方法确实有效，但就是解决的方案并没有很清楚的展示出来，从该 issues 中有好几个人用户提出如何修改就能知道了。&lt;/p&gt;
&lt;h1&gt;开始时遇到的问题&lt;/h1&gt;
&lt;h2&gt;环境&lt;/h2&gt;
&lt;p&gt;后台使用 &lt;code class=&quot;language-text&quot;&gt;Spring MVC [V 4.08]&lt;/code&gt;，前端使用一个开源的 &lt;code class=&quot;language-text&quot;&gt;HTML5&lt;/code&gt; 框架&lt;/p&gt;
&lt;h2&gt;问题&lt;/h2&gt;
&lt;p&gt;ios 可完美上传，安卓手机一半以上不太支持，出现进度条卡死，图片无法上传成功而且只能上传 png 格式图片的问题（后来证明是由于压缩失败引起的，在解决中详细指出）。发布到服务器上正式运营以后，发现部分用户只填写了文字信息，无法上传图片，不好统计数据，但是这样的 BUG 率显然是不行的，接下来就给出我的解决方案吧，经过实际测试应该是没问题的，不保证完全有效，因为原理不是太清楚，仅供参考。&lt;/p&gt;
&lt;h1&gt;后来的解决方案&lt;/h1&gt;
&lt;h2&gt;第一步，sendAsBinary: true&lt;/h2&gt;
&lt;p&gt;我先是按照 issues 中给出的第一个解决方法，设置 &lt;code class=&quot;language-text&quot;&gt;sendAsBinary: true&lt;/code&gt;，后台不做任何修改的情况下会产生 &lt;code class=&quot;language-text&quot;&gt;500&lt;/code&gt; 的错误，但是此时解决了进度条卡死的问题（当然啊！图片直接就上传失败了！）……根据 issues 中 &lt;strong&gt;2betop&lt;/strong&gt; 的回答，此时获取文件应该是直接获取文件的二进制流。&lt;/p&gt;
&lt;p&gt;之前获取图片的方式是使用 &lt;code class=&quot;language-text&quot;&gt;Spring&lt;/code&gt; 自带的 &lt;code class=&quot;language-text&quot;&gt;MultipartHttpServletRequest&lt;/code&gt; 将 &lt;code class=&quot;language-text&quot;&gt;HttpServletRequest&lt;/code&gt; 的实例 &lt;code class=&quot;language-text&quot;&gt;request&lt;/code&gt; 转换，然后获取多个文件的信息。下方代码根据实际代码删减不必要的细枝末节得出。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;        MultipartHttpServletRequest multipartRequest &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;MultipartHttpServletRequest&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; request&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

        &lt;span class=&quot;token comment&quot;&gt;// 获取上传文件的列表&lt;/span&gt;
        Map&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;String&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; MultipartFile&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; fileMap &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; multipartRequest&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getFileMap&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

        &lt;span class=&quot;token comment&quot;&gt;// 图片上传前的原始名&lt;/span&gt;
        String originalName&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

        &lt;span class=&quot;token comment&quot;&gt;// 循环获取多文件上传时文件列表中的每个文件对象&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Map&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Entry&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;String&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; MultipartFile&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; entity &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; fileMap&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;entrySet&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;

            &lt;span class=&quot;token comment&quot;&gt;// 上传文件&lt;/span&gt;
            MultipartFile mf &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; entity&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getValue&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

            &lt;span class=&quot;token comment&quot;&gt;// 文件上传前的原始名&lt;/span&gt;
            originalName &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; mf&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getOriginalFilename&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

            &lt;span class=&quot;token comment&quot;&gt;// 文件扩展名&lt;/span&gt;
            String fileExt &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; originalName&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;substring&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;originalName&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;lastIndexOf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;.&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;toLowerCase&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

            &lt;span class=&quot;token comment&quot;&gt;// 文件的绝对路径File&lt;/span&gt;
            File uploadFile &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;File&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;uploadAbsolutePath &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;/&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; newName&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

            &lt;span class=&quot;token keyword&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                FileCopyUtils&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;copy&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;mf&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getBytes&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; uploadFile&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;IOException&lt;/span&gt; ioException&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                logger&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;图片保存到文件夹中出错！&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; ioException&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Exception&lt;/span&gt; e&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                logger&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;文件没有复制到指定的目录下&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; e&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;这是原本的获取方式，&lt;code class=&quot;language-text&quot;&gt;500&lt;/code&gt; 报错时指示是第一行代码出错，无法转换，因为此时 &lt;code class=&quot;language-text&quot;&gt;WebUploader&lt;/code&gt; 在设置了 &lt;code class=&quot;language-text&quot;&gt;sendAsBinary: true&lt;/code&gt;后 并没有使用 &lt;code class=&quot;language-text&quot;&gt;content-type: multipart/form-data&lt;/code&gt; 上传文件，而是 &lt;code class=&quot;language-text&quot;&gt;content-type: application/ocet-stream&lt;/code&gt;,源码中也是这么写的，但是实际获取的请求头中并没有看到这个字段，而只是图片的类型.下列给出我使用 Chrome 的 devTools 保存下来的请求信息,只贴出 &lt;code class=&quot;language-text&quot;&gt;headers&lt;/code&gt; 中的字段值（针对同一个上传 API 提出请求）：&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;500 错误时的请求头&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;          &lt;span class=&quot;token property&quot;&gt;&quot;url&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;http://localhost:8787/lostFound/front/release/upload?releaseType=0&amp;amp;orderId=330&amp;amp;id=WU_FILE_1&amp;amp;name=20140120_035024000_iOS.jpg&amp;amp;type=image%2Fjpeg&amp;amp;lastModifiedDate=Sat+Jan+31+2015+01%3A32%3A34+GMT%2B0800+(%C3%A4%C2%B8%C2%AD%C3%A5%C2%9B%C2%BD%C3%A6%C2%A0%C2%87%C3%A5%C2%87%C2%86%C3%A6%C2%97%C2%B6%C3%A9%C2%97%C2%B4)&amp;amp;size=81666&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
          &lt;span class=&quot;token property&quot;&gt;&quot;httpVersion&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;HTTP/1.1&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
          &lt;span class=&quot;token property&quot;&gt;&quot;headers&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
              &lt;span class=&quot;token property&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Origin&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
              &lt;span class=&quot;token property&quot;&gt;&quot;value&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;http://localhost:8787&quot;&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
              &lt;span class=&quot;token property&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Accept-Encoding&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
              &lt;span class=&quot;token property&quot;&gt;&quot;value&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;gzip, deflate&quot;&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
              &lt;span class=&quot;token property&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Host&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
              &lt;span class=&quot;token property&quot;&gt;&quot;value&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;localhost:8787&quot;&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
              &lt;span class=&quot;token property&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Accept-Language&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
              &lt;span class=&quot;token property&quot;&gt;&quot;value&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;zh-CN,zh;q=0.8&quot;&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
              &lt;span class=&quot;token property&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;User-Agent&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
              &lt;span class=&quot;token property&quot;&gt;&quot;value&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Mozilla/5.0 (iPhone; CPU iPhone OS 9_1 like Mac OS X) AppleWebKit/601.1.46 (KHTML, like Gecko) Version/9.0 Mobile/13B143 Safari/601.1&quot;&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
              &lt;span class=&quot;token property&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Content-Type&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
              &lt;span class=&quot;token property&quot;&gt;&quot;value&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;image/jpeg&quot;&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
              &lt;span class=&quot;token property&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Accept&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
              &lt;span class=&quot;token property&quot;&gt;&quot;value&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;*/*&quot;&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
              &lt;span class=&quot;token property&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Referer&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
              &lt;span class=&quot;token property&quot;&gt;&quot;value&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;http://localhost:8787/lostFound/&quot;&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
              &lt;span class=&quot;token property&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Cookie&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
              &lt;span class=&quot;token property&quot;&gt;&quot;value&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;JSESSIONID=2839511C91E9ECE62D155C6EE18F3259; JSESSIONID=64B53863E1C7D82B96927F298A864E18&quot;&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
              &lt;span class=&quot;token property&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Connection&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
              &lt;span class=&quot;token property&quot;&gt;&quot;value&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;keep-alive&quot;&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
              &lt;span class=&quot;token property&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Content-Length&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
              &lt;span class=&quot;token property&quot;&gt;&quot;value&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;81666&quot;&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
          &lt;span class=&quot;token property&quot;&gt;&quot;queryString&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
              &lt;span class=&quot;token property&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;releaseType&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
              &lt;span class=&quot;token property&quot;&gt;&quot;value&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;0&quot;&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
              &lt;span class=&quot;token property&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;orderId&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
              &lt;span class=&quot;token property&quot;&gt;&quot;value&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;330&quot;&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
              &lt;span class=&quot;token property&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;id&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
              &lt;span class=&quot;token property&quot;&gt;&quot;value&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;WU_FILE_1&quot;&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
              &lt;span class=&quot;token property&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
              &lt;span class=&quot;token property&quot;&gt;&quot;value&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;20140120_035024000_iOS.jpg&quot;&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
              &lt;span class=&quot;token property&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;type&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
              &lt;span class=&quot;token property&quot;&gt;&quot;value&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;image%2Fjpeg&quot;&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
              &lt;span class=&quot;token property&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;lastModifiedDate&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
              &lt;span class=&quot;token property&quot;&gt;&quot;value&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Sat+Jan+31+2015+01%3A32%3A34+GMT%2B0800+(%C3%A4%C2%B8%C2%AD%C3%A5%C2%9B%C2%BD%C3%A6%C2%A0%C2%87%C3%A5%C2%87%C2%86%C3%A6%C2%97%C2%B6%C3%A9%C2%97%C2%B4)&quot;&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
              &lt;span class=&quot;token property&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;size&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
              &lt;span class=&quot;token property&quot;&gt;&quot;value&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;81666&quot;&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;，
          &lt;span class=&quot;token property&quot;&gt;&quot;bodySize&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;&lt;strong&gt;在不修改 sendAsBinary: true 之前成功上传的请求头&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;          &lt;span class=&quot;token property&quot;&gt;&quot;url&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;http://localhost:8787/lostFound/front/release/upload&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
          &lt;span class=&quot;token property&quot;&gt;&quot;httpVersion&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;HTTP/1.1&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
          &lt;span class=&quot;token property&quot;&gt;&quot;headers&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
              &lt;span class=&quot;token property&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Origin&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
              &lt;span class=&quot;token property&quot;&gt;&quot;value&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;http://localhost:8787&quot;&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
              &lt;span class=&quot;token property&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Accept-Encoding&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
              &lt;span class=&quot;token property&quot;&gt;&quot;value&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;gzip, deflate&quot;&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
              &lt;span class=&quot;token property&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Host&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
              &lt;span class=&quot;token property&quot;&gt;&quot;value&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;localhost:8787&quot;&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
              &lt;span class=&quot;token property&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Accept-Language&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
              &lt;span class=&quot;token property&quot;&gt;&quot;value&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;zh-CN,zh;q=0.8&quot;&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
              &lt;span class=&quot;token property&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;User-Agent&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
              &lt;span class=&quot;token property&quot;&gt;&quot;value&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Mozilla/5.0 (iPhone; CPU iPhone OS 9_1 like Mac OS X) AppleWebKit/601.1.46 (KHTML, like Gecko) Version/9.0 Mobile/13B143 Safari/601.1&quot;&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
              &lt;span class=&quot;token property&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Content-Type&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
              &lt;span class=&quot;token property&quot;&gt;&quot;value&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;multipart/form-data; boundary=----WebKitFormBoundaryLeVpfViKLf1xLdIr&quot;&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
              &lt;span class=&quot;token property&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Accept&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
              &lt;span class=&quot;token property&quot;&gt;&quot;value&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;*/*&quot;&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
              &lt;span class=&quot;token property&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Referer&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
              &lt;span class=&quot;token property&quot;&gt;&quot;value&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;http://localhost:8787/lostFound/&quot;&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
              &lt;span class=&quot;token property&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Cookie&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
              &lt;span class=&quot;token property&quot;&gt;&quot;value&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;JSESSIONID=A76C40D04276501F54675AA02AE61467; JSESSIONID=64B53863E1C7D82B96927F298A864E18&quot;&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
              &lt;span class=&quot;token property&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Connection&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
              &lt;span class=&quot;token property&quot;&gt;&quot;value&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;keep-alive&quot;&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
              &lt;span class=&quot;token property&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Content-Length&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
              &lt;span class=&quot;token property&quot;&gt;&quot;value&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;44210&quot;&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
          &lt;span class=&quot;token property&quot;&gt;&quot;queryString&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
          &lt;span class=&quot;token property&quot;&gt;&quot;bodySize&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;929&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;比较两者的区别，发现区别：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;content-type&lt;/code&gt;： 修改为 &lt;code class=&quot;language-text&quot;&gt;sendAsBinary: true&lt;/code&gt; 以后，这个值变为 &lt;code class=&quot;language-text&quot;&gt;image/jpeg&lt;/code&gt;， 而之前是 &lt;code class=&quot;language-text&quot;&gt;multipart/form-data&lt;/code&gt;，所以不能再使用 &lt;code class=&quot;language-text&quot;&gt;MultipartHttpServletRequest&lt;/code&gt;，后端获取改为获取文件流。&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;queryString&lt;/code&gt;：启用二进制上传以后，参数直接添加到 &lt;code class=&quot;language-text&quot;&gt;Url&lt;/code&gt; 中。&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;bodySize&lt;/code&gt;：启用之后变为 &lt;code class=&quot;language-text&quot;&gt;0&lt;/code&gt;，启用之前不为 0&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;先修改后端获取方式，代码更改如下：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;        File file &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;File&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;uploadAbsolutePath&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;file&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;exists&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;file&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;mkdirs&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token comment&quot;&gt;// 如果file对象不存在，那么就将该对象的路径名中不存在的文件夹目录建立出来&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

        &lt;span class=&quot;token comment&quot;&gt;// 文件扩展名&lt;/span&gt;
        String fileExt &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; name&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;substring&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;name&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;lastIndexOf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;.&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;toLowerCase&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

        &lt;span class=&quot;token comment&quot;&gt;// 文件的绝对路径File&lt;/span&gt;
        File uploadFile &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;File&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;uploadAbsolutePath &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;/&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; newName&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

        &lt;span class=&quot;token keyword&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token comment&quot;&gt;// 将上传的图片二进制流保存为文件&lt;/span&gt;
            FileCopyUtils&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;copy&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;request&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getInputStream&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;FileOutputStream&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;uploadFile&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;IOException&lt;/span&gt; ioException&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            logger&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;图片保存到文件夹中出错！&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; ioException&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Exception&lt;/span&gt; e&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            logger&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;文件没有复制到指定的目录下&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;e&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;此时后端就能够获取前端上传的图片了，ios 机型（iPhone 6s）依然没问题，安卓上传 png 格式的图片没有任何问题，但是 jpg 依然无法上传。在后端的时候，打印 &lt;code class=&quot;language-text&quot;&gt;request&lt;/code&gt; 的 &lt;code class=&quot;language-text&quot;&gt;headers&lt;/code&gt;，发现安卓机型上传 jpg 图片是会丢失 &lt;code class=&quot;language-text&quot;&gt;content-type&lt;/code&gt;，值为空。结合 issues 中的判断，也许是安卓机型在压缩 jpg 格式图片时出了问题，先解决再试试看！&lt;/p&gt;
&lt;h2&gt;第二步：加上 androidpatch&lt;/h2&gt;
&lt;p&gt;根据官方说明，使用 &lt;code class=&quot;language-text&quot;&gt;webuploader.custom.js&lt;/code&gt;，其中将 runtime/html5/androidpatch.js 打包了进来。然后在没有修改任何代码的情况下，经过五个手机的测试，新老机型：华为荣耀、魅蓝、联想等等的测试，安卓机可以在微信中随意上传图片了。这是个大坑啊！说明无法上传 jpg 格式图片的原因竟是压缩 jpg 格式图片的时候出错，导致进度条卡死，上传失败。&lt;/p&gt;
&lt;h1&gt;总结使用心得&lt;/h1&gt;
&lt;p&gt;按照以上的总结，我想下一次我应该能再一次利用这一次的经验解决微信上传图片的坑了~也懂得从&lt;code class=&quot;language-text&quot;&gt;request&lt;/code&gt; 的 &lt;code class=&quot;language-text&quot;&gt;headers&lt;/code&gt; 中寻找 bug 发生的原因，&lt;code class=&quot;language-text&quot;&gt;WebUploader&lt;/code&gt; 是个很优秀的开源插件，源码也写的很有条理，清晰易读，虽然我并没有读完。现在阅读框架源码是越来越轻松了，加油，下个目标是正在学习的 &lt;code class=&quot;language-text&quot;&gt;React.js&lt;/code&gt;。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[WEB 全栈的学习]]></title><description><![CDATA[此篇博客是阅读《WEB…]]></description><link>https://chengjianhua.github.io/web-full-stack-review/</link><guid isPermaLink="false">https://chengjianhua.github.io/web-full-stack-review/</guid><pubDate>Sun, 27 Mar 2016 22:14:54 GMT</pubDate><content:encoded>&lt;p&gt;此篇博客是阅读《WEB 全栈工程师的自我修养》后结合自己的一些想法总结而出的，希望能给自己以外的人带来些许收获。&lt;/p&gt;
&lt;h2&gt;先精后广，一专多长&lt;/h2&gt;
&lt;p&gt;先说明这句话的含义：在一个特定的方向上有足够深入的钻研，然后再将学习的范围扩展开来。如何拓展，围绕核心的专长，先是该领域所需要的知识再拓展前后相关的领域的学习。例如，我现在以前端为发展目标，我需要学习 &lt;code class=&quot;language-text&quot;&gt;JavaScript&lt;/code&gt;、&lt;code class=&quot;language-text&quot;&gt;CSS&lt;/code&gt;、&lt;code class=&quot;language-text&quot;&gt;HTML&lt;/code&gt;，这是这个领域所需要的最基本的知识。其中的&lt;code class=&quot;language-text&quot;&gt;JavaScript&lt;/code&gt;还可以往&lt;code class=&quot;language-text&quot;&gt;Node.js&lt;/code&gt;发展，这样又是一条拓展的方向，此时就往 JS 版的后端靠近了。为了熟悉 WEB 的开发，最好还得懂后端的开发流程或者具备后端开发的能力（好在我在大二的时候，开始就是写后端的）。为了能编写出具有良好用户体验的交互页面，还可以学点设计。对于大前端，原生 APP 的 UI 也是能学习的一个方向。除此之外，还有很多的技能树……基于这些，&lt;strong&gt;如果一开始你最基本的前端没专精到一定程度，相关联的都学了个遍，最后在有限精力的限制下没有突出任何亮点！&lt;/strong&gt; 工作需要你在你所负责的领域里做到足够好，没有一门专精的技术是站不住脚跟的。作者的话是：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;有一个专长，得到一个能让您成长的工作，进入强大的团队，您就能有自己的阵地，以此为生，然后再逐步学习更加广博的知识，朝自己的个人目标去努力。如果您连阵地都不稳固，就不存在开枝散叶、落地生根的可能性了。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;!-- more --&gt;
&lt;p&gt;如何做到专精呢，在掌握了基础的前提下，继续深入到性能优化、SEO（Search Engine Optimization）、多种框架，响应式页面等前端细节中去。&lt;/p&gt;
&lt;h2&gt;围绕商业目标去学习&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;当您只有一把锤子，您看什么都像钉子&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;为了工作的话，不能一心只醉于一门单独的技术，要考虑你的技能能带来的收益。有人要反驳了（我也想），一门做到极致不就够了么？但是何必吊死一棵树上，编程语言是工具，不能痴迷于一个工具死不放手，当别的工具能更好的实现你想要达成的目标的时候，就该给自己的工具箱里添加一个新工具了。&lt;/p&gt;
&lt;h2&gt;关注用户体验&lt;/h2&gt;
&lt;p&gt;这个我只能看看作者的观点了，用户体验很重要，现在都是产品为王，内容至上的时代。各种优秀的产品刁钻了用户的品味。所以，&lt;strong&gt;每一个糟糕的用户体验背后都蕴育商机&lt;/strong&gt;。要做自己产品的用户，从用户的角度去考虑产品的使用方式。作者泛化了 &lt;em&gt;用户&lt;/em&gt; 的定义：&lt;strong&gt;所有您为之服务的人&lt;/strong&gt;。比如我们课程中的 PPT 演讲，表达自己观点的时候。基于接收方的立场来进行你的“服务”。&lt;/p&gt;
&lt;h1&gt;从学生到工程师&lt;/h1&gt;
&lt;h2&gt;证明自己的能力&lt;/h2&gt;
&lt;p&gt;作为一个大三的在读学生，专业所在学校不出彩。但是可以有的是项目经验，在老师的工作室中有机会参与到实际的项目当中，完成任务目标的过程中能学到额外的许多知识。但是小项目毕竟有其局限，而我想从事的前端在学校除了&lt;code class=&quot;language-text&quot;&gt;HTML5&lt;/code&gt;的课程与其关联，并学不到有关的前端技术。一切只能靠自学，光有项目经验也许不够，还需要更多用以展示自己的作品，作品是证明自己能力的最佳工具。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;参与到开源社区中去&lt;/strong&gt;，提到这个莫过于 &lt;a href=&quot;https://github.com/&quot; title=&quot;GitHub&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;GitHub&lt;/code&gt;&lt;/a&gt;了。一直觉得自己没那个能力加入到其中去，或许只是不够自信。往后在熟悉的项目中看看 issues 列表，看看有没有自己能解决的问题，也为使用着的开源项目贡献点微薄之力。那在开源项目中贡献代码有哪些好处呢？&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;证明了&lt;strong&gt;阅读和编写好的代码的能力&lt;/strong&gt;，公司直接需要的技能&lt;/li&gt;
&lt;li&gt;开源项目需要协作，&lt;strong&gt;协作能力&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;对新鲜事物的热情&lt;/li&gt;
&lt;li&gt;开源项目多为英文描述，&lt;strong&gt;英文不错&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;阅读文档的能力&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;博客&lt;/strong&gt;，如果觉得前面那个难以做到的话，那么这个只需要你总结自己获得的经验和知识，然后把它描述出来，用键盘敲出来。唯一的成本是时间与耐心，然而付出的这两样收获的是一份梳理完整后的知识体系。可以简单的使用 &lt;a href=&quot;http://blog.csdn.net/&quot; title=&quot;CSDN&quot;&gt;CSDN&lt;/a&gt;的博客来书写，支持 &lt;code class=&quot;language-text&quot;&gt;Markdown&lt;/code&gt; 语法，或者是使用 &lt;code class=&quot;language-text&quot;&gt;hexo + GitHub Pages&lt;/code&gt;搭建一个静态博客，很简单，丰富的主题效果可以自由选择。还有 &lt;code class=&quot;language-text&quot;&gt;WordPress&lt;/code&gt;之类的选择，推荐 &lt;code class=&quot;language-text&quot;&gt;hexo&lt;/code&gt;，免费使用，配置简单。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;个人项目&lt;/strong&gt;，这个选择其实相当不错，可以运用学到的最新技术和自己喜欢的技术结合起来，不受任何人限制的最大化利用自己的知识体系。平时课程中有许多的大作业，如果时间足够，可以很用心的来完成一个酷炫狂拽*炸天的作品。期待能够完成我的这个计划。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;大公司更有利于成长&lt;/h2&gt;
&lt;p&gt;这么说的原因无非是大公司能提供更好的环境，避免成为“野生程序员”（什么都懂一点，但是基础和技能的专业性都不够）。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;严格的代码质量&lt;/li&gt;
&lt;li&gt;有更多的经验丰富的前辈来指导你&lt;/li&gt;
&lt;li&gt;垂直专精的技能。对一个领域技能足够深度的训练，小公司则是广度，因为身兼数职&lt;/li&gt;
&lt;li&gt;服务于海量用户的经验。小公司遇到的问题，大公司肯定遇到过；大公司遇到的问题，小公司不一定能遇到。服务不同人数的项目，所需要考虑的问题是很不一样的，性能优化与许多的工程问题在小公司的项目中并不需要考虑太多，这会造成进阶能力的缺失。&lt;/li&gt;
&lt;/ul&gt;
&lt;h1&gt;向移动端的转型&lt;/h1&gt;
&lt;p&gt;作者提到这个，是因为目前移动端十分热门，大家都用手机下载、使用着各式各样的 App，在目前，原生 App 确实体验更好。说到转向移动端，我就提提我所了解到的可能——&lt;strong&gt;混合模式 App（&lt;a href=&quot;http://www.infoq.com/cn/articles/hybridapp-misunderstanding&quot;&gt;Hybird App&lt;/a&gt;）&lt;/strong&gt;。也就是在原生 App 启动后，部分或全部的内容是由&lt;code class=&quot;language-text&quot;&gt;WebView&lt;/code&gt;加载网页实现的，淘宝 App 也是这样做到的。
&lt;code class=&quot;language-text&quot;&gt;Ionic&lt;/code&gt;、&lt;code class=&quot;language-text&quot;&gt;PhoneGap&lt;/code&gt;都能达到用&lt;code class=&quot;language-text&quot;&gt;JavaScript&lt;/code&gt;编写，然后导出成多个平台的应用的目的。&lt;strong&gt;“一次编写，到处运行”&lt;/strong&gt;，自然有其缺点，如果想了解，可以点击链接查看或者 Google。&lt;/p&gt;
&lt;h1&gt;知识性内容&lt;/h1&gt;
&lt;p&gt;这里列出一些书中提到的知识性内容，有许多我都并不是了解，仅在此做个记录，待之后的学习中深入。&lt;/p&gt;
&lt;h2&gt;HTTP 基本原理及优化方式&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;减少请求&lt;/strong&gt;、&lt;strong&gt;减小文件&lt;/strong&gt;。在这里有个疑惑，最近看到了&lt;code class=&quot;language-text&quot;&gt;HTTP2&lt;/code&gt;这个新的 HTTP 规范，其中提到了新技术中减少请求不是那么必要的优化措施，还可能是反优化，但是鉴于目前的方案以及 `HTTP2 的尚未普及，这两样应该仍是我们所需要知道的最基本的优化方式。&lt;/p&gt;
&lt;h2&gt;缓存带来的性能提升&lt;/h2&gt;
&lt;p&gt;还不太了解这部分的内容，先不做总结……&lt;/p&gt;
&lt;h2&gt;设计模式&lt;/h2&gt;
&lt;p&gt;待最近正阅读《JavaScript 设计模式》的读完后来个总结。&lt;/p&gt;
&lt;h1&gt;工具使用&lt;/h1&gt;
&lt;h2&gt;版本控制工具&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;&lt;code class=&quot;language-text&quot;&gt;Git&lt;/code&gt;&lt;/strong&gt; 是现在非常流行和有名的版本控制工具，最早是 Linux 之父为了对 Linux 系统的版本控制而开发出的一个工具。官方的中文教程： &lt;a href=&quot;https://git-scm.com/book/zh/v2&quot;&gt;《Git Book》&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;版本控制的最佳实践：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;鼓励频繁提交&lt;/strong&gt;。对于可能损坏主干原则的代码可以创建一个分支，在分支中频繁提交。此外可以尽情的频繁提交，不要等着代码没问题了再一次性提交，对于功能性的提交请加上必要的备注信息。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;确定分支流程&lt;/strong&gt;。基本上所有的特性和较大的 bug 修复都应该使用分支来修改。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;定义主干原则，并坚守它&lt;/strong&gt;。主干对应的代码必须是可以发布并且不会产生 bug 的，如果不能保证新增的或者修改的代码符合这一个原则，就在分支中提交代码。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;不要把逻辑的修改代码格式化操作混淆在一起&lt;/strong&gt;。为了问题的回溯，如果只是格式化了代码之类的操作，也请单独提交这次修改，然后再做一些逻辑的修改（实质性的代码的修改），再提交。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;不相干的代码单独提交&lt;/strong&gt;。也就是说不要在一次提交中修复两个 bug。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;保持工作代码库的“干净”&lt;/strong&gt;。把不想活不需要提交的文件加入到“忽略列表”中去，包括，编译后文件、配置文件和第三方依赖。避免打开 svn 的提交列表，显示一堆没必要的文件。&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;包管理&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;npm&lt;/strong&gt;、&lt;strong&gt;Bower&lt;/strong&gt;是两个基于&lt;code class=&quot;language-text&quot;&gt;Node.js&lt;/code&gt;的包管理工具。&lt;/p&gt;
&lt;h2&gt;构建工具&lt;/h2&gt;
&lt;p&gt;作者提到了 &lt;code class=&quot;language-text&quot;&gt;Grunt&lt;/code&gt;、&lt;code class=&quot;language-text&quot;&gt;Gulp&lt;/code&gt;，结合我个人的学习，我会在接下来学习的构建工具为：&lt;code class=&quot;language-text&quot;&gt;Gulp&lt;/code&gt;、&lt;code class=&quot;language-text&quot;&gt;Webpack&lt;/code&gt;。其中&lt;code class=&quot;language-text&quot;&gt;Webpack&lt;/code&gt;与著名的&lt;code class=&quot;language-text&quot;&gt;React&lt;/code&gt;框架还有&lt;code class=&quot;language-text&quot;&gt;ES6 + Babel&lt;/code&gt;的结合使用是我想要学习的主要原因。&lt;/p&gt;
&lt;h1&gt;Geek&lt;/h1&gt;
&lt;p&gt;可以学习使用&lt;strong&gt;VPS&lt;/strong&gt;搭建属于自己的小服务器，可以使用它来部署自己的项目上去玩玩，据我所知，还能科学上网(●’◡’●)&lt;/p&gt;
&lt;h1&gt;一些建议&lt;/h1&gt;
&lt;h2&gt;高效工程师&lt;/h2&gt;
&lt;h3&gt;阅读英文资料&lt;/h3&gt;
&lt;p&gt;这个无可厚非，软件开发领域的英文资料最齐全，文档最新。使用框架的时候可以免于查找中文文档的艰辛……英文能力对英语程序员的进阶还是十分重要的。&lt;/p&gt;
&lt;p&gt;在此推荐一个大家都知道的社区 &lt;strong&gt;StackOverflow&lt;/strong&gt;，作为最大的 IT 工程师平台，平时我们遇到的许多问题基本都能找到详尽的解决方案。除了这个我还想推荐两个我经常向身边的朋友推荐的中文社区（我没收广告费！）&lt;a href=&quot;http://segmentfault.com/&quot;&gt;SegmentFault&lt;/a&gt;、&lt;a href=&quot;http://gold.xitu.io/#/&quot;&gt;稀土掘金&lt;/a&gt;&lt;/p&gt;
&lt;h3&gt;时间管理&lt;/h3&gt;
&lt;p&gt;作者介绍了一个广为人知但是却也很有效的时间管理工具：&lt;strong&gt;时间管理四象限&lt;/strong&gt;
&lt;img src=&quot;http://7xs7xr.com1.z0.glb.clouddn.com/shijiansixiangxian.jpg&quot; alt=&quot;地方个&quot;&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;重要而且紧急&lt;/li&gt;
&lt;li&gt;不重要但紧急&lt;/li&gt;
&lt;li&gt;重要但不紧急&lt;/li&gt;
&lt;li&gt;不重要不紧急&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;应该将 &lt;strong&gt;80% 的时间花在“重要但不紧急”象限中，避免“瞎忙”&lt;/strong&gt;。奇妙清单、Trello 都是不错的时间管理工具，奇妙清单简单易用，Trello 则更加全面但是使用更复杂一些。&lt;/p&gt;
&lt;h3&gt;给自己留出不被打扰的时间&lt;/h3&gt;
&lt;p&gt;编写程序需要大量的精神投入，需要整块连续的时间思考，尽量腾出整块的时间来进行工作，不仅仅是编码，做计划、总结、思考同样需要。&lt;/p&gt;
&lt;h3&gt;纸上头脑风暴&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;笔跟纸是最灵活、最容易修改、成本最低的头脑风暴方式。—— 作者&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;之前看过一本&lt;a href=&quot;http://mindhacks.cn/topics/learning-method/&quot;&gt;刘未鹏&lt;/a&gt;前辈写的《暗时间》，里面同样提到了纸是思维的缓冲区，头脑思维有一定的“内存限制”，但是纸却是“无限”的，将脑海中思考的东西一步步记录在纸上可以帮我们整理思路，梳理思维中的条理以及漏洞。所以刘未鹏也是及其推荐写博客的，这是一个自我强化学习的方式。回到正题，我们不一定要遵循完整的“Mind Map”的方式来梳理，只需要将脑海中的关键字列出来，分别拓展开来就能达到帮助我们“风暴”的目的，整理总结同样适用。&lt;/p&gt;
&lt;h2&gt;懂点设计&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;当我们知道一个“东西”的名字，就会在看到这个“东西”的时候，立马意识到它。但是如果我们不知道它的名字，可能一辈子也不会认识它。这就是约书亚树原理。——作者余果&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;以上这句话摘自原书，也是作者引自“《写给大家看的设计书》—— Robin Williams”中。
“设计感”就是我们身边的约书亚树，我们虽然不清楚某个设计为什么是美的，哪些设计是“专业”的，哪些是“业余”的，但是我们能感觉出来。所以懂设计就是让我们不仅能感觉，还能掌控，使我们的创造更加“专业”，更美。&lt;/p&gt;
&lt;h2&gt;跨界&lt;/h2&gt;
&lt;p&gt;其实上面的设计就属于这个，除此之外我们还能学点管理、沟通。其中沟通是我们的软技能，即使我们是技术至上的工程师，但是一个更好的沟通技巧仍然是我们学习工作、生活的绝佳利器。&lt;/p&gt;
&lt;p&gt;不恰当的地方请指教，可在下方评论~&lt;/p&gt;</content:encoded></item><item><title><![CDATA[编写定制标签]]></title><description><![CDATA[定制标签的目的是分离表现逻辑和业务逻辑，可以在 JSP 页面编写中尽量不出现 ，而且可以根据自己想要的功能定制属于自己想要的标签，完成特定的功能。 这里只讲在 JSP2.…]]></description><link>https://chengjianhua.github.io/customize-tag-of-jsp/</link><guid isPermaLink="false">https://chengjianhua.github.io/customize-tag-of-jsp/</guid><pubDate>Thu, 24 Mar 2016 00:00:39 GMT</pubDate><content:encoded>&lt;p&gt;定制标签的目的是分离表现逻辑和业务逻辑，可以在 JSP 页面编写中尽量不出现&lt;code class=&quot;language-text&quot;&gt;scriptlet&lt;/code&gt;，而且可以根据自己想要的功能定制属于自己想要的标签，完成特定的功能。&lt;/p&gt;
&lt;p&gt;这里只讲在 JSP2.0 之后添加的一个用于编写定制标签的接口—— &lt;code class=&quot;language-text&quot;&gt;SimpleTag&lt;/code&gt; ，这个接口实现简单，效果也不错。&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;SimpleTag&lt;/code&gt;接口位于&lt;code class=&quot;language-text&quot;&gt;javax.servlet.jsp.tagext&lt;/code&gt;中，实现了该接口的标签处理器称作简单的标签处理器。&lt;code class=&quot;language-text&quot;&gt;SimpleTag&lt;/code&gt;接口中只有一个方法：&lt;code class=&quot;language-text&quot;&gt;doTag()&lt;/code&gt;，并且在标签调用时只执行一次。业务逻辑及主题操作代码都要在这里编写。&lt;/p&gt;
&lt;hr&gt;
&lt;h3&gt;一个简单的标签处处理器的生命周期如下：&lt;/h3&gt;
&lt;!-- more --&gt;
&lt;h4&gt;JSP 容器通过调用其无参构造函数，创建一个简单标签处理器实例。因此，简单的处理器必须有一个无参构造器。&lt;/h4&gt;
&lt;h4&gt;JSP 容器调用&lt;code class=&quot;language-text&quot;&gt;setJspCOntext&lt;/code&gt;方法，同时传递一个&lt;code class=&quot;language-text&quot;&gt;JspContext&lt;/code&gt;对象。&lt;code class=&quot;language-text&quot;&gt;JspContext&lt;/code&gt;最重要的方法是&lt;code class=&quot;language-text&quot;&gt;getOut&lt;/code&gt;，它返回一个&lt;code class=&quot;language-text&quot;&gt;JspWriter&lt;/code&gt;，用于将响应发送到客户端。&lt;code class=&quot;language-text&quot;&gt;setJspContext&lt;/code&gt;方法的签名如下：&lt;/h4&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; setJspContext &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;JspContext jspContext&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;大多数时候,需要将传进来的&lt;code class=&quot;language-text&quot;&gt;JspContext&lt;/code&gt;对象赋给一个类级变量，便于后续使用。&lt;/p&gt;
&lt;h4&gt;如果表示标签处理器的定制标签是嵌套在另一个标签中的，JSP 容器就会调用&lt;code class=&quot;language-text&quot;&gt;setParent&lt;/code&gt;方法。该方法的签名如下：&lt;/h4&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;setParent&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;JspTag parent&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;h4&gt;JSP 容器为该标签定义的每个属性都调用设置方法（Setters）&lt;/h4&gt;
&lt;h4&gt;如果标签中有主体内容，JSP 将调用&lt;code class=&quot;language-text&quot;&gt;SimpleTag&lt;/code&gt;接口中的&lt;code class=&quot;language-text&quot;&gt;setJspBody&lt;/code&gt;方法，将主体内容作为&lt;code class=&quot;language-text&quot;&gt;JspFragment&lt;/code&gt;传递。如果没有主体内容，JSP 容器将不会调用这个方法。&lt;/h4&gt;
&lt;h4&gt;JSP 容器调用&lt;code class=&quot;language-text&quot;&gt;doTag&lt;/code&gt;方法。所有变量在&lt;code class=&quot;language-text&quot;&gt;doTag&lt;/code&gt;方法返回时同步。&lt;/h4&gt;
&lt;hr&gt;
&lt;p&gt;&lt;strong&gt;注：&lt;/strong&gt;&lt;code class=&quot;language-text&quot;&gt;javax.servlet.jsp.tagext&lt;/code&gt;包中也含有&lt;code class=&quot;language-text&quot;&gt;SimpleTag&lt;/code&gt;接口的一个支持类：&lt;code class=&quot;language-text&quot;&gt;SimpleTagSupport&lt;/code&gt;。&lt;code class=&quot;language-text&quot;&gt;SimpleTagSupport&lt;/code&gt;为&lt;code class=&quot;language-text&quot;&gt;SimpleTag&lt;/code&gt;接口中的所有方法都提供了默认实现（类似于适配器），我们可以继承它来编写一个简单的标签处理器。当 JSP 容器调用&lt;code class=&quot;language-text&quot;&gt;SimpleTag&lt;/code&gt;接口的&lt;code class=&quot;language-text&quot;&gt;setJspContext&lt;/code&gt;方法时，&lt;code class=&quot;language-text&quot;&gt;SimpleTagSupport&lt;/code&gt;类中的&lt;code class=&quot;language-text&quot;&gt;getJspContext&lt;/code&gt;方法将返回 JSP 容器传递的&lt;code class=&quot;language-text&quot;&gt;JspContext&lt;/code&gt;实例。&lt;/p&gt;
&lt;hr&gt;
&lt;h3&gt;编写处理器&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;为了编译标签处理器，需要在构建路径中包含&lt;code class=&quot;language-text&quot;&gt;Servlet API&lt;/code&gt; 和&lt;code class=&quot;language-text&quot;&gt;JSP API&lt;/code&gt;类包。例如&lt;code class=&quot;language-text&quot;&gt;Tomcat&lt;/code&gt;的&lt;code class=&quot;language-text&quot;&gt;servlet-api.jar&lt;/code&gt;文件和&lt;code class=&quot;language-text&quot;&gt;jsp-api.jar&lt;/code&gt;文件。&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; java&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;io&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;IOException&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; javax&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;servlet&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;jsp&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;JspContext&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; javax&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;servlet&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;jsp&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;JspException&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; javax&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;servlet&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;jsp&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;tagext&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;JspFragment&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; javax&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;servlet&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;jsp&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;tagext&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;JspTag&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; javax&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;servlet&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;jsp&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;tagext&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;SimpleTag&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MyFirstTag&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;implements&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;SimpleTag&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;

	JspContext jspContext&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

	&lt;span class=&quot;token annotation punctuation&quot;&gt;@Override&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;doTag&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;throws&lt;/span&gt; JspException&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; IOException &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		System&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;out&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;doTag&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
		jspContext&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getOut&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;This is my first tag.&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

	&lt;span class=&quot;token annotation punctuation&quot;&gt;@Override&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; JspTag &lt;span class=&quot;token function&quot;&gt;getParent&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		System&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;out&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;getParent&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
		&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; null&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

	&lt;span class=&quot;token annotation punctuation&quot;&gt;@Override&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;setJspBody&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;JspFragment body&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		System&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;out&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;setJspBody&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

	&lt;span class=&quot;token annotation punctuation&quot;&gt;@Override&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;setJspContext&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;JspContext jspContext&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		System&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;out&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;getJspContext&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
		&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;jspContext &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; jspContext&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

	&lt;span class=&quot;token annotation punctuation&quot;&gt;@Override&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;setParent&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;JspTag parent&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		System&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;out&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;setParent&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;MyFIrstTag&lt;/code&gt;类有一个类型为&lt;code class=&quot;language-text&quot;&gt;JspContext&lt;/code&gt;的&lt;code class=&quot;language-text&quot;&gt;jspContext&lt;/code&gt;变量。&lt;code class=&quot;language-text&quot;&gt;setJspContext&lt;/code&gt;方法将它从 JSP 容器接收到的&lt;code class=&quot;language-text&quot;&gt;JspContext&lt;/code&gt;赋给这个变量。&lt;code class=&quot;language-text&quot;&gt;doTag&lt;/code&gt;方法利用&lt;code class=&quot;language-text&quot;&gt;JspContext&lt;/code&gt;获得一个&lt;code class=&quot;language-text&quot;&gt;JspWriter&lt;/code&gt;。然后调用&lt;code class=&quot;language-text&quot;&gt;JspWriter&lt;/code&gt;的&lt;code class=&quot;language-text&quot;&gt;print&lt;/code&gt;方法，输出&lt;em&gt;This is my first tag.&lt;/em&gt;&lt;/p&gt;
&lt;h3&gt;注册标签&lt;/h3&gt;
&lt;p&gt;用一个以&lt;code class=&quot;language-text&quot;&gt;.tld&lt;/code&gt;为扩展名的 XML 文件描述标签处理器。以下示例&lt;code class=&quot;language-text&quot;&gt;mytags.tld&lt;/code&gt;：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-xml&quot;&gt;&lt;code class=&quot;language-xml&quot;&gt;&lt;span class=&quot;token prolog&quot;&gt;&amp;lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;/span&gt;
&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;taglib&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;xmlns&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;http://java.sun.com/xml/ns/j2ee&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token attr-name&quot;&gt;&lt;span class=&quot;token namespace&quot;&gt;xmlns:&lt;/span&gt;xsi&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;http://www.w3.org/2001/XMLSchema-instance&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token attr-name&quot;&gt;&lt;span class=&quot;token namespace&quot;&gt;xsi:&lt;/span&gt;schemaLocation&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;http://java.sun.com/xml/ns/j2ee web-jsptaglibrary_2_1.xsd&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token attr-name&quot;&gt;version&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;2.1&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;

    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;description&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
         Simple tag examples
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;description&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;tlib-version&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;1.0&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;tlib-version&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;short-name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;My First Taglib Example&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;short-name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;tag&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
        &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;firstTag&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
        &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;tag-class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;customtag.MyFirstTag&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;tag-class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
		&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;body-content&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;empty&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;body-content&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;tag&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;

    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;tag&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
        &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;dataFormatter&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
        &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;tag-class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;customtag.DataFormatterTag&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;tag-class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
        &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;body-content&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;empty&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;body-content&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
        &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;attribute&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
            &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;header&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
            &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;required&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;true&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;required&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
        &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;attribute&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
        &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;attribute&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
            &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;items&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
            &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;required&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;true&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;required&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
        &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;attribute&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;tag&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;


    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;tag&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
        &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;select&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
        &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;tag-class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;customtag.SelectElementTag&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;tag-class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
        &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;body-content&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;scriptless&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;body-content&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;tag&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;

&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;taglib&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;标签类库描述符中的主要元素是&lt;code class=&quot;language-text&quot;&gt;tag&lt;/code&gt;，它用来描述标签，其中包含一个&lt;code class=&quot;language-text&quot;&gt;name&lt;/code&gt;元素和一个&lt;code class=&quot;language-text&quot;&gt;tag--class&lt;/code&gt;元素。&lt;code class=&quot;language-text&quot;&gt;name&lt;/code&gt;用于给该标签命名。&lt;code class=&quot;language-text&quot;&gt;tag-class&lt;/code&gt;用于指定标签处理器的全类名。一个&lt;code class=&quot;language-text&quot;&gt;.tld&lt;/code&gt;文件中可以包含多个&lt;code class=&quot;language-text&quot;&gt;tag&lt;/code&gt;元素。
&lt;code class=&quot;language-text&quot;&gt;description&lt;/code&gt;用于描述&lt;code class=&quot;language-text&quot;&gt;tag&lt;/code&gt;元素。&lt;code class=&quot;language-text&quot;&gt;short-name&lt;/code&gt;为标签的简称。&lt;code class=&quot;language-text&quot;&gt;tlib-version&lt;/code&gt;元素设置定制标签的版本。&lt;/p&gt;
&lt;h3&gt;使用标签&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-html&quot;&gt;&lt;code class=&quot;language-html&quot;&gt;&amp;lt;%@ taglib uri=&quot;WEB-INF/mytags.tld&quot; prefix=&quot;easy&quot;&gt;
&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;html&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;head&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
	&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;title&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;测试我的第一个标签&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;title&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;head&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;

&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;body&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
Hello!&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;br&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;/&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token namespace&quot;&gt;easy:&lt;/span&gt;firstTag&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;token namespace&quot;&gt;easy:&lt;/span&gt;firstTag&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;body&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;html&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;在控制台上将显示：&lt;/p&gt;
&lt;p&gt;&lt;em&gt;setJspContext&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;em&gt;doTag&lt;/em&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[exists 与 not exists 的概念与用法]]></title><description><![CDATA[…]]></description><link>https://chengjianhua.github.io/exists-compareTo-not-exists/</link><guid isPermaLink="false">https://chengjianhua.github.io/exists-compareTo-not-exists/</guid><pubDate>Wed, 23 Mar 2016 23:57:28 GMT</pubDate><content:encoded>&lt;h3&gt;&lt;strong&gt;原理：&lt;/strong&gt;利用&lt;code class=&quot;language-text&quot;&gt;exists&lt;/code&gt;或&lt;code class=&quot;language-text&quot;&gt;not exists&lt;/code&gt;查询时，它是对父句中的每一次循环都执行查询子句来判断当前循环指向的元组是否满足查询子句的结果集不为（为）空，如果满足了的话，就将当前元组输出到父句的结果集中。&lt;/h3&gt;
&lt;!-- more --&gt;
&lt;h4&gt;&lt;code class=&quot;language-text&quot;&gt;exists&lt;/code&gt;&lt;/h4&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;where&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;exists&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
	查询子句&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;如果有结果集被返回，则父句中的&lt;code class=&quot;language-text&quot;&gt;where&lt;/code&gt;语句的结果为真，那么输出当前元组到结果集中。&lt;/p&gt;
&lt;h4&gt;&lt;code class=&quot;language-text&quot;&gt;not exists&lt;/code&gt;&lt;/h4&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;where&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;exists&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
	查询子句&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;如果子句返回的结果集为空（不存在满足查询子句条件的元组），那么输出当前元组到结果集中，否则不输出。&lt;/p&gt;
&lt;h3&gt;示例&lt;/h3&gt;
&lt;p&gt;&lt;em&gt;摘自 leetcode&lt;/em&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;职员：
|Id|Name|Salary|DepartmentId|
|:----|:-----| :-----|:-----|
| 1 | Joe | 70000 | 1 |
| 2 | Henry | 80000 | 2 |
| 3 | Sam | 60000 | 2 |
| 4 | Max | 90000 | 1 |&lt;/p&gt;
&lt;p&gt;部门：
| Id | Name |
| :-----|:-----|
| 1 | IT |
| 2 | Sales |&lt;/p&gt;
&lt;p&gt;要求输出每个部门薪水最高的员工的信息，输出格式及结果应为如下：&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&quot;left&quot;&gt;Department&lt;/th&gt;
&lt;th align=&quot;left&quot;&gt;Employee&lt;/th&gt;
&lt;th align=&quot;left&quot;&gt;Salary&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&quot;left&quot;&gt;IT&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;Max&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;90000&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;left&quot;&gt;Sales&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;Henry&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;80000&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;p&gt;解决方法：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; D&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Name&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;A&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Name&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;A&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Salary
&lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt;
    Employee A&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    Department D
&lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; A&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;DepartmentId &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; D&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Id
  &lt;span class=&quot;token operator&quot;&gt;AND&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;NOT&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;EXISTS&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; Employee B &lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; B&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Salary &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; A&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Salary &lt;span class=&quot;token operator&quot;&gt;AND&lt;/span&gt; A&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;DepartmentId &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; B&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;DepartmentId&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;SELECT 1 FROM Employee B WHERE ...&lt;/code&gt;这里为何是&lt;code class=&quot;language-text&quot;&gt;SELECT 1&lt;/code&gt;呢？因为上面说过只判断有没有结果集返回，无论返回的是什么都能用来做判断。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[常用的 JSTL 标签]]></title><description><![CDATA[1. 标签 注意： 如果 值为 的话，那么 中的字符串中包含的”,&,’,<,>等等特殊字符将会被转化成对应的字符实体代码          函数中类似的用法: 2. 标签 注意：…]]></description><link>https://chengjianhua.github.io/frequently-used-jstl-tags/</link><guid isPermaLink="false">https://chengjianhua.github.io/frequently-used-jstl-tags/</guid><pubDate>Wed, 23 Mar 2016 23:44:33 GMT</pubDate><content:encoded>&lt;h3&gt;1.&lt;code class=&quot;language-text&quot;&gt;out&lt;/code&gt;标签&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;&amp;lt;c:out value=&amp;quot;value&amp;quot; [escapeXml=&amp;quot;{true|false}&amp;quot;] [default=&amp;quot;defaultValue&amp;quot;]/&amp;gt;

//括号中的内容为可选项&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;&amp;lt;c:out value=&amp;quot;value&amp;quot; [escapeXml=&amp;quot;{true|false}&amp;quot;]&amp;gt;
	defaultValue
&amp;lt;/c:out&amp;gt;&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;&lt;strong&gt;注意：&lt;/strong&gt;如果&lt;code class=&quot;language-text&quot;&gt;escapeXml&lt;/code&gt;值为&lt;code class=&quot;language-text&quot;&gt;true&lt;/code&gt;的话，那么&lt;code class=&quot;language-text&quot;&gt;value&lt;/code&gt;中的字符串中包含的”,&amp;#x26;,’,&amp;#x3C;,&gt;等等特殊字符将会被转化成对应的字符实体代码 &lt;code class=&quot;language-text&quot;&gt;&amp;amp;#034;&lt;/code&gt; &lt;code class=&quot;language-text&quot;&gt;&amp;amp;amp;&lt;/code&gt; &lt;code class=&quot;language-text&quot;&gt;&amp;amp;#039;&lt;/code&gt; &lt;code class=&quot;language-text&quot;&gt;&amp;amp;lt;&lt;/code&gt; &lt;code class=&quot;language-text&quot;&gt;&amp;amp;gt;&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;EL&lt;/code&gt;函数中类似的用法:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;${fn:escapeXml(&amp;quot;Use &amp;lt;br&amp;gt; to change lines&amp;quot;)}&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;h3&gt;2.&lt;code class=&quot;language-text&quot;&gt;foreach&lt;/code&gt;标签&lt;/h3&gt;
&lt;!-- more --&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;&amp;lt;c:forEach items=&amp;quot;collection&amp;quot; [var=&amp;quot;varName&amp;quot;] [begin=&amp;quot;begin&amp;quot;] [end=&amp;quot;end&amp;quot;] [step=&amp;quot;step&amp;quot;] [varStatus=&amp;quot;varStatusName&amp;quot;]&amp;gt;
	body content
&amp;lt;/c:forEach&amp;gt;&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;&lt;strong&gt;注意：&lt;/strong&gt; 1. &lt;code class=&quot;language-text&quot;&gt;items&lt;/code&gt;表示需要迭代的对象集合，可以迭代的对象包括所有的&lt;code class=&quot;language-text&quot;&gt;java.util.Iterator&lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;java.util.Map&lt;/code&gt;接口的实现，以及对象或者基本类型的数组。 2. &lt;code class=&quot;language-text&quot;&gt;varStatus&lt;/code&gt;返回当前迭代的次数，类似于在 for 循环中 int i 的递增 3. &lt;code class=&quot;language-text&quot;&gt;begin&lt;/code&gt; 可以指定迭代开始的索引 4. &lt;code class=&quot;language-text&quot;&gt;end&lt;/code&gt;可以指定迭代结束的索引 5. &lt;code class=&quot;language-text&quot;&gt;step&lt;/code&gt;表示迭代的索引递增的步长，如果该值要有的话必须大于等于 1&lt;/p&gt;
&lt;h3&gt;3.&lt;code class=&quot;language-text&quot;&gt;if&lt;/code&gt;标签&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;没有主体内容的形式，在这种情况下，var指定的限域变量一般由同一个JSP页面中更后面的另一个标签的测试所决定&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;&amp;lt;c:if test=&amp;quot;testCondition&amp;quot; var=&amp;quot;varName&amp;quot; [scope=&amp;quot;{page|request|session|application}&amp;quot;]/&amp;gt;&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;有主体内容为 JSP 的，如果测试结果为 true，主体内容就会得到处理，否则不处理。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;&amp;lt;c:if test=&amp;quot;testCondition&amp;quot; [var=&amp;quot;varName&amp;quot;] [scope=&amp;quot;{page|request|session|application}&amp;quot;]&amp;gt;
	body content
&amp;lt;/c:if&amp;gt;&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;h3&gt;4.&lt;code class=&quot;language-text&quot;&gt;formatDate&lt;/code&gt;标签&lt;/h3&gt;
&lt;p&gt;完整语法格式：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;&amp;lt;fmt:formatDate value = &amp;quot;date&amp;quot;
	[type=&amp;quot;{time|date|both}&amp;quot;]
	[dateStyle=&amp;quot;{default|short|medium|long|full}&amp;quot;]
	[timeStyle=&amp;quot;{default|short|medium|long|full}&amp;quot;]
	[pattern=&amp;quot;customPattern&amp;quot;]
	[timeZone=&amp;quot;timeZone&amp;quot;]
	[var=&amp;quot;varName&amp;quot;]
	[scope=&amp;quot;{page|request|session|application}&amp;quot;]
/&amp;gt;&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;使用示例：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;&amp;lt;fmt:formatDate value=&amp;quot;&amp;lt;%=new Date()%&amp;gt;&amp;quot; type=&amp;quot;both&amp;quot; pattern=&amp;quot;yyyy年MM月dd日 hh小时mm分钟ss秒&amp;quot; /&amp;gt;
//效果显示：2015年9月10日 22小时06分10秒&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;&lt;strong&gt;以上是使用的最多的几个，几乎是一个网站制作过程必然用到的，剩下的一些好用的标签但不是那么常用的以后再补充。&lt;/strong&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[初学者对 Servlet、JSP 及 Web 容器之间关系的理解]]></title><description><![CDATA[就是一个 Java…]]></description><link>https://chengjianhua.github.io/knowledges-about-jsp-servlet-container/</link><guid isPermaLink="false">https://chengjianhua.github.io/knowledges-about-jsp-servlet-container/</guid><pubDate>Wed, 23 Mar 2016 23:33:37 GMT</pubDate><content:encoded>&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Servlet&lt;/code&gt;就是一个 Java 程序，一个&lt;code class=&quot;language-text&quot;&gt;Servlet&lt;/code&gt;应用程序经常包含一个或者多个&lt;code class=&quot;language-text&quot;&gt;Servlet&lt;/code&gt;也就是当用户发送请求，例如提交表单，那么需要一个或多个&lt;code class=&quot;language-text&quot;&gt;Servlet&lt;/code&gt;协同作用，而访问的&lt;code class=&quot;language-text&quot;&gt;jsp&lt;/code&gt;页面也是一个&lt;code class=&quot;language-text&quot;&gt;Servlet&lt;/code&gt;。当每次我们发送请求时，&lt;code class=&quot;language-text&quot;&gt;Servlet&lt;/code&gt;应用程序中的&lt;code class=&quot;language-text&quot;&gt;service()&lt;/code&gt;方法就会被触发执行一次。当初次访问一个&lt;code class=&quot;language-text&quot;&gt;Servlet&lt;/code&gt;时，&lt;code class=&quot;language-text&quot;&gt;init()&lt;/code&gt;方法会触发执行一次，之后的请求都是执行&lt;code class=&quot;language-text&quot;&gt;service()&lt;/code&gt;方法。&lt;/p&gt;
&lt;!-- more --&gt;
&lt;p&gt;如果你觉得奇怪，为什么没看到过&lt;code class=&quot;language-text&quot;&gt;service()&lt;/code&gt;这个方法，那是因为我们一般用的是通过继承&lt;code class=&quot;language-text&quot;&gt;HttpServlet&lt;/code&gt;来实现&lt;code class=&quot;language-text&quot;&gt;Servlet&lt;/code&gt;，而在&lt;code class=&quot;language-text&quot;&gt;HttpServlet&lt;/code&gt;中一般的请求我们只要&lt;code class=&quot;language-text&quot;&gt;@override&lt;/code&gt; &lt;code class=&quot;language-text&quot;&gt;doGet()&lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;doPost()&lt;/code&gt;方法即可实现我们对请求的处理。而&lt;code class=&quot;language-text&quot;&gt;HttpServlet&lt;/code&gt;中的&lt;code class=&quot;language-text&quot;&gt;service()&lt;/code&gt;方法会根据请求的类型调用对应的&lt;code class=&quot;language-text&quot;&gt;doGet()&lt;/code&gt;、&lt;code class=&quot;language-text&quot;&gt;doPost()&lt;/code&gt;等等方法，所以只要实现&lt;code class=&quot;language-text&quot;&gt;doGet()&lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;doPost()&lt;/code&gt;方法等等即可。&lt;/p&gt;
&lt;p&gt;为什么说&lt;code class=&quot;language-text&quot;&gt;jsp&lt;/code&gt;也是一个&lt;code class=&quot;language-text&quot;&gt;Servlet&lt;/code&gt;呢，那是因为当我们使用&lt;code class=&quot;language-text&quot;&gt;Servlet/JSP&lt;/code&gt;容器时，例如最常用的&lt;code class=&quot;language-text&quot;&gt;Tomcat&lt;/code&gt;会将&lt;code class=&quot;language-text&quot;&gt;jsp&lt;/code&gt;文件转化成相应的一个&lt;code class=&quot;language-text&quot;&gt;Servlet&lt;/code&gt;程序，&lt;code class=&quot;language-text&quot;&gt;jsp&lt;/code&gt;页面的主体就转化成相应代码位于&lt;code class=&quot;language-text&quot;&gt;service()&lt;/code&gt;方法当中。&lt;code class=&quot;language-text&quot;&gt;jsp&lt;/code&gt;技术只是将开发变得简单，然而基本原理还是不变的，实现及其复杂的&lt;code class=&quot;language-text&quot;&gt;Servlet&lt;/code&gt;就由&lt;code class=&quot;language-text&quot;&gt;Tomcat&lt;/code&gt;这一类的容器来实现，我们只要实现&lt;code class=&quot;language-text&quot;&gt;jsp&lt;/code&gt;页面就可以了。&lt;/p&gt;
&lt;p&gt;访问&lt;code class=&quot;language-text&quot;&gt;Servlet&lt;/code&gt;只需为地址添加映射到&lt;code class=&quot;language-text&quot;&gt;Servlet&lt;/code&gt;类即可或者是&lt;code class=&quot;language-text&quot;&gt;@WebServlet&lt;/code&gt;注解实现。&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Servlet&lt;/code&gt;是一个接口，含有五个方法：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;init&lt;/code&gt;。仅在第一次访问 Servlet 时调用，之后不再调用。&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;service&lt;/code&gt;。每次请求 Servlet 时，Servlet 容器都会调用这个方法。第一次调用 init，之后调用 service。这里编写 Servlet 要实现的处理代码。&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;destroy&lt;/code&gt;。销毁 Servlet 时，Servlet 容器就会调用这个方法。&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;getServletInfo&lt;/code&gt;……&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;getServletConfig&lt;/code&gt;……&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&quot;http://img.blog.csdn.net/20150905225924654&quot; alt=&quot;类与接口&quot;&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[函数的属性、方法以及构造函数]]></title><description><![CDATA[函数也是对象，它们也可以拥有属性和方法，就像其他普通对象可以拥有属性和方法一样。 length…]]></description><link>https://chengjianhua.github.io/function-attributes-methods-constructor/</link><guid isPermaLink="false">https://chengjianhua.github.io/function-attributes-methods-constructor/</guid><pubDate>Thu, 25 Feb 2016 10:38:54 GMT</pubDate><content:encoded>&lt;p&gt;函数也是对象，它们也可以拥有属性和方法，就像其他普通对象可以拥有属性和方法一样。&lt;/p&gt;
&lt;h2&gt;length 属性&lt;/h2&gt;
&lt;p&gt;在函数体中，&lt;code class=&quot;language-text&quot;&gt;arguments.length&lt;/code&gt; 表示传入函数的实参的个数（也就是实际传入的参数的个数）。函数本身也有一个 &lt;code class=&quot;language-text&quot;&gt;length&lt;/code&gt; 属性，这个属性为只读属性,它代表的是函数在定义时的形参的个数，也就是我们在函数调用时期望传入函数的参数个数。&lt;/p&gt;
&lt;p&gt;接下来用一段代码示例一下该属性的用法：&lt;/p&gt;
&lt;!-- more --&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;check&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;args&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; actual &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; args&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;length &lt;span class=&quot;token comment&quot;&gt;// 实参的真实个数&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; expected &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; args&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;callee&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;length &lt;span class=&quot;token comment&quot;&gt;// 期望的参数的个数&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;actual &lt;span class=&quot;token operator&quot;&gt;!==&lt;/span&gt; expected&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Error&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Expected &apos;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; expected &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;args; got &apos;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; actual&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;x&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; y&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; z&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;check&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;arguments&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; x &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; y &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; z
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;arguments.callee&lt;/code&gt;不能在严格模式下工作。&lt;code class=&quot;language-text&quot;&gt;arguments.callee&lt;/code&gt; 代表当前正在执行的函数，该属性还能在匿名函数中递归调用自身。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;/blockquote&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;var factorial = function (x) {
	if (x &amp;lt;= 1) return 1;
return x * arguments.callee(x - 1);
}&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;## prototype 属性

每一个函数都包含一个 `prototype` 属性，这个属性是指向一个对象的引用，这个对象称为“原型对象” （prototype object）。每一个函数都包含不同的原型对象。当将函数作为构造函数使用的时候，新创建的对象会从原型对象上继承属性。详细内容我会在另一篇文章中继续讨论。

## call()方法和apply()方法

我们可以将call()方法和apply()方法看做是某个对象的方法，通过调用方法的形式来间接调用。call()和apply()的第一个实参是要来调用call()或apply()的对象，第一个实参是调用上下文，在函数体中使用 `this` 来获得对它的引用。

以对象o的方法来调用函数f()：

```javascript
f.call(o);
f.apply(o);&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;blockquote&gt;
&lt;ol&gt;
&lt;li&gt;严格模式中：
&lt;code class=&quot;language-text&quot;&gt;call()&lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;apply()&lt;/code&gt;的第一个实参都会变为 this 的值，哪怕传入的实参是原始值、&lt;code class=&quot;language-text&quot;&gt;null&lt;/code&gt; 或 &lt;code class=&quot;language-text&quot;&gt;undefined&lt;/code&gt;。&lt;/li&gt;
&lt;li&gt;非严格模式中：传入的 &lt;code class=&quot;language-text&quot;&gt;null&lt;/code&gt; 和 &lt;code class=&quot;language-text&quot;&gt;undefined&lt;/code&gt;都会被替代成全局对象,而其他的原始对象会被替代为相应的包装对象。&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
&lt;p&gt;call()和 apply()方法的主要不同在于它们在传入第一个实参（对象）后，传入后续该函数所需要的参数时的方式不同，接下来，让我们对比一下。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;f.call(o, 1, 2);
f.apply(o, [1,2]);&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;call()方法的函数参数的传入方式为：第一个上下文参数后的所有参数就是该函数实际上需要的实参。
apply()方法：后续的参数以数组的形式传入。&lt;/p&gt;
&lt;p&gt;主要区别就是 call()在传入上下文参数以后，函数本身需要多少个参数，那么&lt;code class=&quot;language-text&quot;&gt;f.call(context, arg1, arg2, arg3,arg4 ...)&lt;/code&gt;在 contxt 之后就添加多少个参数。而 &lt;code class=&quot;language-text&quot;&gt;apply()&lt;/code&gt; 则是 &lt;code class=&quot;language-text&quot;&gt;f.apply.(context, [arg1, arg2, arg3, arg4 ...])&lt;/code&gt;。函数需要的参数包含在一个数组对象（也可以是类数组对象）中。&lt;strong&gt;实际编写过程中，可以将当前函数的 &lt;code class=&quot;language-text&quot;&gt;arguments&lt;/code&gt; 对象传入另一个函数的 &lt;code class=&quot;language-text&quot;&gt;apply()&lt;/code&gt; 来使用&lt;/strong&gt;，示例如下：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;/**
 * [trace 将对象o中名为m的方法替换为另一个方法，该方法能够在调用原始的方法之前和之后记录日志消息]
 * @param  {[type]} o [要替换方法的对象]
 * @param  {[type]} m [需要替换的方法]
 */&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;trace&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;o&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; m&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; original &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; o&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;m&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;

  o&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;m&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Date&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;Entering:&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; m&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 输出日志消息&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; result &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; original&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;apply&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; arguments&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 调用原始函数&lt;/span&gt;
    console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Date&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;Exiting:&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; m&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; result
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;</content:encoded></item><item><title><![CDATA[JavaScript中 == 和 === 使用的区别]]></title><description><![CDATA[先明确一点，在 JavaScript…]]></description><link>https://chengjianhua.github.io/js-equal-compare/js-equal-compare/</link><guid isPermaLink="false">https://chengjianhua.github.io/js-equal-compare/js-equal-compare/</guid><pubDate>Mon, 01 Feb 2016 12:03:09 GMT</pubDate><content:encoded>&lt;p&gt;先明确一点，在 JavaScript 中&lt;strong&gt;对象的比较是引用的比较&lt;/strong&gt;，而不是值的比较。对象和本身是相等的，和其他任何对象都是不相等的。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;变量名保存的是对象在内存中的引用地址，我们把创建的的对象赋值给我们声明的变量名时，就是将引用赋值给变量.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;==&lt;/code&gt; 和 &lt;code class=&quot;language-text&quot;&gt;===&lt;/code&gt; 的区别在于，前者进行比较时会将两边的表达式的值按照规则进行类型转换后再来判断，而后者计算出两边的操作数的值后并不做类型转换，所以后者的比较是&lt;strong&gt;严格的判断类型与值的比较方式&lt;/strong&gt;。&lt;/p&gt;
&lt;h2&gt;&lt;code class=&quot;language-text&quot;&gt;===&lt;/code&gt; 的使用&lt;/h2&gt;
&lt;!-- more --&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;如果两个值类型不同，则他们不相等&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;NaN&lt;/code&gt; 和任何值都不相等包括它本身，所以 &lt;code class=&quot;language-text&quot;&gt;NaN === NaN&lt;/code&gt; 的结果为 &lt;code class=&quot;language-text&quot;&gt;false&lt;/code&gt;，所以如果想要判断一个值是否为 &lt;code class=&quot;language-text&quot;&gt;NaN&lt;/code&gt; 时，可以使用 &lt;code class=&quot;language-text&quot;&gt;x !== x&lt;/code&gt;，该表达式的结果仅当 &lt;code class=&quot;language-text&quot;&gt;x&lt;/code&gt; 为 &lt;code class=&quot;language-text&quot;&gt;NaN&lt;/code&gt; 是的时候才为 &lt;code class=&quot;language-text&quot;&gt;true&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;如果两个引用值指向同一个对象、数组或函数，则他们是相等的。如果指向不同的对象，则他们是不等的，尽管两个对象具有完全一样的属性&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;&lt;code class=&quot;language-text&quot;&gt;==&lt;/code&gt; 的使用&lt;/h2&gt;
&lt;p&gt;如果两个操作数的类型相同，则和上述的严格相等的比较规则是一样的，结果是相同的。&lt;/p&gt;
&lt;p&gt;如果两个操作数的类型不同，将会按照以下规则进行类型转换：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;null == undefined&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;如果比较数字与字符串，先将字符串转换成数字，然后比较两个数字的值是否相等&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;如果其中一个值是 &lt;code class=&quot;language-text&quot;&gt;true&lt;/code&gt; ，则将其转换为 &lt;code class=&quot;language-text&quot;&gt;1&lt;/code&gt; 后再进行比较，&lt;code class=&quot;language-text&quot;&gt;false&lt;/code&gt; 转换为 &lt;code class=&quot;language-text&quot;&gt;0&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;如果一个值是对象，另一个值是数字或字符串时，JavaScript 语言内置类首先尝试使用 &lt;code class=&quot;language-text&quot;&gt;valueOf()&lt;/code&gt;，再尝试使用 &lt;code class=&quot;language-text&quot;&gt;toString()&lt;/code&gt;，除了日期类，日期类只使用 &lt;code class=&quot;language-text&quot;&gt;toString()&lt;/code&gt; 转换。那些不是 JavaScript 语言核心中的对象则通过各自的实现中定义的方法转换为原始值&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;其他不同类型之间的比较都不相等&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;例子&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&apos;1&apos;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// true&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;布尔值 &lt;code class=&quot;language-text&quot;&gt;true&lt;/code&gt; 首先转化为 &lt;code class=&quot;language-text&quot;&gt;1&lt;/code&gt;，然后字符串 &lt;code class=&quot;language-text&quot;&gt;&amp;quot;1&amp;quot;&lt;/code&gt;和 数字 &lt;code class=&quot;language-text&quot;&gt;1&lt;/code&gt; 比较的时候转换成数字 &lt;code class=&quot;language-text&quot;&gt;1&lt;/code&gt;，所以结果为 &lt;code class=&quot;language-text&quot;&gt;true&lt;/code&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[类型、值、和变量]]></title><description><![CDATA[包装对象 先给一段代码来看看 概念解释 ：直接量并不是对象，但是为什么能像使用一个对象样的使用它呢，这是因为对于字符串、数字、布尔值，当你引用该直接量的属性（方法）时，JavaScript…]]></description><link>https://chengjianhua.github.io/js-learning-class/</link><guid isPermaLink="false">https://chengjianhua.github.io/js-learning-class/</guid><pubDate>Sun, 17 Jan 2016 22:43:28 GMT</pubDate><content:encoded>&lt;h2&gt;包装对象&lt;/h2&gt;
&lt;p&gt;先给一段代码来看看&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; s &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;hello&apos;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// s - &quot;hello&quot;&lt;/span&gt;
s&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;len &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// s.len - 4&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; t &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; s&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;len &lt;span class=&quot;token comment&quot;&gt;// t - undefined&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;概念解释&lt;/strong&gt;：直接量并不是对象，但是为什么能像使用一个对象样的使用它呢，这是因为对于字符串、数字、布尔值，当你引用该直接量的属性（方法）时，JavaScript 会创建一个相应的&lt;strong&gt;临时&lt;/strong&gt;对象，例如 &lt;code class=&quot;language-text&quot;&gt;new String(s)&lt;/code&gt;，引用属性（方法）完成后，创建的&lt;strong&gt;临时对象就会被销毁&lt;/strong&gt;。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;!-- more --&gt;
&lt;p&gt;当运行这段代码以后，t 的值是 &lt;code class=&quot;language-text&quot;&gt;undefined&lt;/code&gt; 。第二行代码会创建一个临时字符串对象，并给其 &lt;code class=&quot;language-text&quot;&gt;len&lt;/code&gt; 属性赋值为 4，随机销毁这个对象。第三行运行的时候，相当于又通过原始的、不可变的 &lt;code class=&quot;language-text&quot;&gt;s&lt;/code&gt; 的值来创建了一个 &lt;code class=&quot;language-text&quot;&gt;String&lt;/code&gt;对象，并尝试读取一个不存在的属性 &lt;code class=&quot;language-text&quot;&gt;len&lt;/code&gt; 并将这个属性的值赋值给 &lt;code class=&quot;language-text&quot;&gt;t&lt;/code&gt;，此时当然结果为 &lt;code class=&quot;language-text&quot;&gt;undefined&lt;/code&gt;。这说明了一点：&lt;strong&gt;在读取字符串、数字、布尔值的属性值或方法的时候，该直接量表现的就像是对象一样，但是如果尝试给其属性赋值，那么赋值的这个操作是发生在临时创建出来的对象身上，而该临时对象在操作完成后就被删除，原始的直接量并无发生任何变化！&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;总结：&lt;strong&gt;直接量能使用对应对象的属性（方法），但是只能读取，对直接量本身并无任何影响！即直接量是只读的！&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; str &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;str&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  strObject &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;str&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;str &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; strObject&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// true&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;str &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; strObject&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// false&lt;/span&gt;

&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;typeof&lt;/span&gt; str&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// &quot;string&quot;&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;typeof&lt;/span&gt; strObject&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// &quot;object&quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;对于直接量和其包装对象，注意到他们的类型并不相同，直接量 &lt;code class=&quot;language-text&quot;&gt;str&lt;/code&gt; 对应的是 &lt;code class=&quot;language-text&quot;&gt;&amp;quot;string&amp;quot;&lt;/code&gt;，而包装对象 &lt;code class=&quot;language-text&quot;&gt;strObject&lt;/code&gt; 的是 &lt;code class=&quot;language-text&quot;&gt;&amp;quot;object&amp;quot;&lt;/code&gt;，两者在不严格的 &lt;code class=&quot;language-text&quot;&gt;==&lt;/code&gt; 模式下的比较结果为 &lt;code class=&quot;language-text&quot;&gt;true&lt;/code&gt;，在严格的 &lt;code class=&quot;language-text&quot;&gt;===&lt;/code&gt; 比较模式下为 &lt;code class=&quot;language-text&quot;&gt;false&lt;/code&gt;。&lt;/p&gt;</content:encoded></item></channel></rss>