webpackJsonp([0xe5478e9ae204],{552:function(n,a){n.exports={data:{site:{siteMetadata:{title:"Blog - Jianhua Cheng",author:"Jianhua Cheng"}},markdownRemark:{id:"/Users/chengjianhua/Documents/codes/chengjianhua.github.io/src/pages/penv.macro-use/index.md absPath of file >>> MarkdownRemark",html:'<h2 id="ä»‹ç»"><a href="#%E4%BB%8B%E7%BB%8D" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>ä»‹ç»</h2>\n<p>é¦–å…ˆ, <a href="https://github.com/chengjianhua/penv.macro"><code class="language-text">penv.macro</code></a> æ˜¯åŸºäº <a href="https://github.com/kentcdodds/babel-plugin-macros"><code class="language-text">babel-plugin-macros</code></a> åˆ›å»ºçš„ä¸€ä¸ª babel æ’ä»¶.</p>\n<p>å®ƒèƒ½ç”¨æ¥<strong>åœ¨ä¸€ä¸ªä»£ç æ–‡ä»¶ä¸­ç»Ÿä¸€ç®¡ç†</strong>ä½ çš„ç¯å¢ƒå˜é‡, è¿™äº›ç¯å¢ƒå˜é‡ä¼šåœ¨ä¸åŒçš„ç¯å¢ƒä¸‹è¢«èµ‹äºˆä¸åŒçš„å€¼. å¹¶ä¸”èƒ½å¤Ÿåšåˆ°<strong>åªé€‰å–å’Œå½“å‰ç¯å¢ƒåŒ¹é…çš„å€¼, ç„¶åå°†å…¶ä»–çš„å€¼åœ¨ babel è½¬æ¢ä»£ç çš„è¿‡ç¨‹ä¸­ä¸­ç§»é™¤</strong>. ä»è€Œç»´æŒäº†ç¼–å†™æ—¶çš„ç›´è§‚æ€§ä»¥åŠç¡®ä¿ä¸ä¼šå°†ä¸æŒ‡å®šç¯å¢ƒä¸ç›¸å¹²çš„ä»£ç å‘å¸ƒåˆ°å¯¹åº”çš„ç¯å¢ƒä¸Š.</p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/twitter-kentcdodds-29a0fb1201fed00928e2e758f58d32f2-fa2eb.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 590px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 103.22033898305085%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAYAAABG1c6oAAAACXBIWXMAAAsSAAALEgHS3X78AAAEmUlEQVQ4y21VaU9cZRTmB5jaT34wJlY/W1u2YRaW2feFYaBAoYkfWottoRQQCakxqJGaaNqaIsZSl1QNkNpFKKYt1KYuEaotSylLnQFsITArDDPD3Nkez3vvFPjgTZ57znmX557nvG/Ozejr7cHc/AJhHvNk/3G64PH54fb64Quswh8IYC0YRJTjwHExAodolOPjWEyImY3HEwhvcMiothRjZvYx3CvLWFpcxOLiU7jdK1ih2EfES8tueLxe3g/4/fD7vPDQPIPb44GH4PP5kEwmEaEPZYRCYUSTwBoHhONAMAYEokIcT9CX11y00cdv8oViWKXxIMEfSSCVwuaTTKYEQhYkaIIj0jghSkE4RpNEHoklSFKYJHFIxGOIJZL8GrZ+G9fms0noWg7htykvRucCmHeHCGE4aWx5NQoPpbMe2oAnEOZrF6E6BUNRPHGvY/rJKkadPky4/Jj+N4DQRprw4x8eQNtwBe90DOKjrtvo7htG/9B93Lp7H32D99AzMIx3O2+jpWMIX18dRsNngzhBaDo3hNcO9uLlql4UnBiAPxgRCM9cGoexoRtVB2rgqNoHXXUVVLZKKIsroLSTte+HzFyBbN0+FForsVddijxDOXSl1RAby/BK8Snk1f2MQDAsEHZcm4Tp+FdQme0Qq1TIUmqRWaRBllzD2z0FKmQWqpAtV2Nv2mYVqfnxrAI5LIc/hPnkINyBkEB4YeAR3nr/InQl5ZCorRBrrZBobcjX2SA1WAhmiHUmZCt0PLLkgs1R6nlS06E2NHX+gWV/mvDP8QV823Mdekc5pBoLxPpiiA0lRGyG3FqCPI0R2cpnJAJRllzLx3sKlHiz+RQ6L/8N31pa8rRzCd/19FHdSlFkK4ahqgIqRykUdjvUpaXkl0Bd5uChrSiDplxYJ1IbsFumQHPbJxgZe4z18IZA+PvYAs52XYLWXkbZmZBvoiy1RpJphMRggoTGmGyp0QyZSShBrkrPZ7o7n2XYjrsjk1uE39yYgb72ApRWR1qWYRuEjbkqI3Ipzlbo+TW5KmE+s1AJUcV7qGy/A+9qWvLpHyfwovUMRBobLdSRFMpOY+JrmEeWxQyM+NnB5KTJc+QqvKRrRW7dTbo26Xt49vIEdhWfRr7RQYdiJmIrRFobnwWTzEtnso3mTZ+Byc9Ta7DL0ApZw82ti/39rRlY67ugsDggImns2oi1Fj47lqVEx4iohnoL+ay+Jr6GIjp9kVIglNbf2CLsuv4Ih9suUoZ2qpOOJ2LZMZmsbswX02YpHZSEyETsQBQa3pdpdXjV1Ir87RmeuzKO2vZuvFH/AQ7UNOLgsUbUNb6NY03NON7cioaWk9hf04IXCo5gh/QodhKelxzFDvER7JTV4jn1p3j90DX419KEI1Mr+PWBEw9nFjAyOoXRh1OYnZ3F2F9jcFIHd7rmcOfeDK/k86tj+OKnCZwn/3z/Q8IkvuyfQvcvLgTDUYEQqSQS1HHZw8WTW03zqZteqXTvE8YTXAT/3w2BDaEfphCklu0NJ6gjx+Ejy9H/gbV0RsE+xPtEzFHDJUOdPIkYrdmCELN/yn/ncKVHRfH5RAAAAABJRU5ErkJggg==\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;"\n        alt="Tweet from Kent C. Dodds"\n        title=""\n        src="/static/twitter-kentcdodds-29a0fb1201fed00928e2e758f58d32f2-fb8a0.png"\n        srcset="/static/twitter-kentcdodds-29a0fb1201fed00928e2e758f58d32f2-1a291.png 148w,\n/static/twitter-kentcdodds-29a0fb1201fed00928e2e758f58d32f2-2bc4a.png 295w,\n/static/twitter-kentcdodds-29a0fb1201fed00928e2e758f58d32f2-fb8a0.png 590w,\n/static/twitter-kentcdodds-29a0fb1201fed00928e2e758f58d32f2-526de.png 885w,\n/static/twitter-kentcdodds-29a0fb1201fed00928e2e758f58d32f2-fa2eb.png 1180w"\n        sizes="(max-width: 590px) 100vw, 590px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<h2 id="\b-ç”¨æ³•"><a href="#%08-%E7%94%A8%E6%B3%95" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>\b ç”¨æ³•</h2>\n<p>å…·ä½“ç”¨æ³•å¯ä»¥å‚è§ <a href="https://github.com/chengjianhua/penv.macro/blob/master/README.zh-CN.md">penv.macro README.zh-CN.md</a>.</p>\n<h2 id="åŠ¨æœº"><a href="#%E5%8A%A8%E6%9C%BA" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>åŠ¨æœº</h2>\n<p>æˆ‘ä»¬ç»å¸¸ä¼šæœ‰<strong>ä¸€äº›å˜é‡æ˜¯éœ€è¦åœ¨ä¸åŒçš„ç¯å¢ƒä¸‹è¢«èµ‹äºˆä¸åŒçš„å€¼</strong>, ä¾‹å¦‚æ¥å£åœ°å€. å¼€å‘ç¯å¢ƒä¸‹å¯èƒ½æ˜¯ä½¿ç”¨æœ¬æœºçš„æ¨¡æ‹Ÿæ¥å£ <code class="language-text">http://localhost:3000/api/</code>, é¢„å‘ç¯å¢ƒä¸‹æ˜¯ <code class="language-text">https://staging.cool-app.com/api</code>, \b\b çº¿ä¸Šç¯å¢ƒä¸‹æ˜¯ <code class="language-text">https://cool-app.com/api</code>. <strong>åŒæ—¶æˆ‘ä»¬å¸Œæœ›åœ¨å¤„äºæŸä¸ªç¯å¢ƒæ—¶, ä¸å±äºè¯¥ç¯å¢ƒçš„é…ç½®ä¸åº”è¯¥å‡ºç°åœ¨è¯¥ç¯å¢ƒçš„ä»£ç ä¸­</strong>. ä¾‹å¦‚å½“å‘å¸ƒç”Ÿäº§ç¯å¢ƒä»£ç çš„æ—¶å€™ä¸å¸Œæœ›æµ‹è¯•ç¯å¢ƒç›¸å…³çš„é…ç½®è¢«æ‰“åŒ…åˆ°ç”Ÿäº§ç¯å¢ƒä½¿ç”¨çš„ä»£ç ä¸­, è¿™æ ·ä¼šæš´éœ²å†…éƒ¨ä½¿ç”¨çš„åŸŸåä»¥åŠå‘å¸ƒäº†å®Œå…¨ä¸éœ€è¦çš„ä»£ç .</p>\n<p>æˆ‘åˆ—ä¸¾ä¸€ä¸‹åœ¨ä½¿ç”¨ <code class="language-text">penv.macro</code> ä¹‹å‰æˆ‘æ‰€äº†è§£çš„å‡ ç§ä¾¿äºå®ç°çš„æ–¹æ³•æˆ–æ€è·¯:</p>\n<ol>\n<li>\n<p>ä½¿ç”¨ <code class="language-text">webpack</code> çš„ \b<code class="language-text">DefinePlugin</code> æˆ–è€… <code class="language-text">EnvironmentPlugin</code>, ç„¶ååœ¨ä½¿ç”¨çš„æ—¶å€™è¯»å– <code class="language-text">process.env.BASE_URL</code> çš„å€¼</p>\n</li>\n<li>\n<p>ç¼–å†™å¤šä¸ªé…ç½®æ–‡ä»¶, é€šè¿‡è®¾ç½®é’ˆå¯¹ä¸åŒç¯å¢ƒçš„åˆ«åæˆ–è€…æ˜¯å†å¢åŠ ä¸€ä¸ªå…¥å£æ–‡ä»¶ç”¨äºåˆ¤æ–­ç¯å¢ƒå¯¼å‡ºå¯¹åº”çš„é…ç½®, ä½¿ç”¨æ—¶ç›´æ¥å¯¼å…¥è¯¥æ¨¡å—å³å¯</p>\n</li>\n<li>\n<p>ç¼–å†™å•ä¸ªæ–‡ä»¶, åœ¨ä¸ºå˜é‡èµ‹å€¼æ—¶æ‰‹å†™åˆ¤æ–­é€»è¾‘, ä½¿ç”¨æ—¶å¯¼å…¥è¯¥æ¨¡å—å³å¯</p>\n</li>\n</ol>\n<p>ä»¥ä¸Šå‡ ç§æ–¹å¼æˆ–å¤šæˆ–å°‘éƒ½æœ‰å…¶ç¹çæˆ–è€…ä¸å¤Ÿåˆç†çš„åœ°æ–¹, <code class="language-text">penv.macro</code> çš„è¯ç”Ÿæ­£æ˜¯ä¸ºäº†è§£å†³é…ç½®ç¹çä»¥åŠç»´æŠ¤æ€§çš„é—®é¢˜. æ¥ä¸‹æ¥ä¼šæœ‰è¯¦ç»†ä»‹ç».</p>\n<h2 id="å¯¹æ¯”"><a href="#%E5%AF%B9%E6%AF%94" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>å¯¹æ¯”</h2>\n<p>åœ¨æ­¤è¯¦ç»†åˆ—ä¸¾å‡ºä¸Šä¸€æ®µä¸­æåˆ°çš„å‡ ç§æ€è·¯çš„å®ç°, åœ¨æœ«å°¾æ€»ç»“å¯¹æ¯”å„ä¸ªæ–¹æ¡ˆçš„, ä»¥ä¾¿è¯»è€…æ›´åŠ äº†è§£ä¸ºä½• <code class="language-text">penv.macro</code> æ˜¯ä¸ªæ›´ä¼˜çš„æ–¹æ¡ˆ.</p>\n<h3 id="webpack"><a href="#webpack" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>webpack</h3>\n<p><code class="language-text">webpack.config.js</code></p>\n<div class="gatsby-highlight">\n      <pre class="language-javascript"><code class="language-javascript"><span class="token comment">// used to pick the value for the specified environment</span>\n<span class="token keyword">const</span> <span class="token function-variable function">pickEnv</span> <span class="token operator">=</span> environmentValues <span class="token operator">=></span> environmentValues<span class="token punctuation">[</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span>NODE_ENV<span class="token punctuation">]</span>\n\nmodule<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>\n  plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>\n    <span class="token keyword">new</span> <span class="token class-name">EnvironmentPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n      NODE_ENV<span class="token punctuation">:</span> <span class="token string">\'production\'</span><span class="token punctuation">,</span>\n      API_BASE<span class="token punctuation">:</span> <span class="token function">pickEnv</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n        development<span class="token punctuation">:</span> <span class="token string">\'http://localhost:3000/api\'</span><span class="token punctuation">,</span>\n        staging<span class="token punctuation">:</span> <span class="token string">\'https://staging.cool-app.com/api\'</span><span class="token punctuation">,</span>\n        production<span class="token punctuation">:</span> <span class="token string">\'https://cool-app.com/api\'</span><span class="token punctuation">,</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n      \bWECHAT_AUTH<span class="token punctuation">:</span> <span class="token function">pickEnv</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n        development<span class="token punctuation">:</span> <span class="token string">\'http://localhost:3000/wechat-auth/api\'</span><span class="token punctuation">,</span>\n        staging<span class="token punctuation">:</span> <span class="token string">\'https://staging.wechat-auth.com/api\'</span><span class="token punctuation">,</span>\n        production<span class="token punctuation">:</span> <span class="token string">\'https://wechat-auth.com/api\'</span><span class="token punctuation">,</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n  <span class="token punctuation">]</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n</code></pre>\n      </div>\n<hr>\n<p><code class="language-text">app.js</code></p>\n<div class="gatsby-highlight">\n      <pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token punctuation">{</span> API_BASE<span class="token punctuation">,</span> WECHAT_AUTH <span class="token punctuation">}</span> <span class="token operator">=</span> process<span class="token punctuation">.</span>env\n</code></pre>\n      </div>\n<p>ä»å®ç°çš„ä¾¿åˆ©æ€§ä¸Š, è¿™æ˜¯æœ€æ¥è¿‘ <code class="language-text">penv.macro</code> çš„æ–¹å¼. ç¼–å†™ç®€å•, ä¸»è¦é—®é¢˜æ˜¯å¤ªè¿‡äºä¾èµ– webpack, å¦‚æœä»£ç éœ€è¦æµ‹è¯•, ä¼šå¢åŠ æµ‹è¯•ç¯å¢ƒæ­å»ºçš„å¤æ‚åº¦. è¯»å–å˜é‡æ—¶ä¹Ÿä¸å¤Ÿç›´è§‚.</p>\n<h3 id="å¤šä¸ªé…ç½®æ–‡ä»¶"><a href="#%E5%A4%9A%E4%B8%AA%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>å¤šä¸ªé…ç½®æ–‡ä»¶</h3>\n<p><code class="language-text">configs/development.js</code></p>\n<div class="gatsby-highlight">\n      <pre class="language-javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">const</span> API_BASE <span class="token operator">=</span> <span class="token string">\'http://localhost:3000/api\'</span>\n</code></pre>\n      </div>\n<p><code class="language-text">configs/staging.js</code></p>\n<div class="gatsby-highlight">\n      <pre class="language-javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">const</span> API_BASE <span class="token operator">=</span> <span class="token string">\'https://staging.cool-app.com/api\'</span>\n</code></pre>\n      </div>\n<p><code class="language-text">configs/production.js</code></p>\n<div class="gatsby-highlight">\n      <pre class="language-javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">const</span> API_BASE <span class="token operator">=</span> <span class="token string">\'https://cool-app.com/api\'</span>\n</code></pre>\n      </div>\n<p>é…ç½®åˆ«åçš„æƒ…å†µä¸‹:</p>\n<p><code class="language-text">.babelrc</code></p>\n<div class="gatsby-highlight">\n      <pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>\n  <span class="token property">"env"</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n    <span class="token property">"development"</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n      <span class="token property">"plugins"</span><span class="token operator">:</span> <span class="token punctuation">[</span>\n        <span class="token punctuation">[</span>\n          <span class="token string">"module-resolver"</span><span class="token punctuation">,</span>\n          <span class="token punctuation">{</span>\n            <span class="token property">"alias"</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n              <span class="token property">"@/config"</span><span class="token operator">:</span> <span class="token string">"./src/configs/development"</span>\n            <span class="token punctuation">}</span>\n          <span class="token punctuation">}</span>\n        <span class="token punctuation">]</span>\n      <span class="token punctuation">]</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    <span class="token property">"staging"</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n      <span class="token property">"plugins"</span><span class="token operator">:</span> <span class="token punctuation">[</span>\n        <span class="token punctuation">[</span>\n          <span class="token string">"module-resolver"</span><span class="token punctuation">,</span>\n          <span class="token punctuation">{</span>\n            <span class="token property">"alias"</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n              <span class="token property">"@/config"</span><span class="token operator">:</span> <span class="token string">"./src/configs/staging"</span>\n            <span class="token punctuation">}</span>\n          <span class="token punctuation">}</span>\n        <span class="token punctuation">]</span>\n      <span class="token punctuation">]</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    <span class="token property">"production"</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n      <span class="token property">"plugins"</span><span class="token operator">:</span> <span class="token punctuation">[</span>\n        <span class="token punctuation">[</span>\n          <span class="token string">"module-resolver"</span><span class="token punctuation">,</span>\n          <span class="token punctuation">{</span>\n            <span class="token property">"alias"</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n              <span class="token property">"@/config"</span><span class="token operator">:</span> <span class="token string">"./src/configs/production"</span>\n            <span class="token punctuation">}</span>\n          <span class="token punctuation">}</span>\n        <span class="token punctuation">]</span>\n      <span class="token punctuation">]</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n</code></pre>\n      </div>\n<p>å¢åŠ å…¥å£æ–‡ä»¶å¹¶æ ¹æ®ç¯å¢ƒå¯¼å‡ºæ–‡ä»¶:</p>\n<p><code class="language-text">config/index.js</code></p>\n<div class="gatsby-highlight">\n      <pre class="language-javascript"><code class="language-javascript"><span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span>NODE_ENV <span class="token operator">===</span> <span class="token string">\'development\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'./development\'</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span>NODE_ENV <span class="token operator">===</span> <span class="token string">\'staging\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'./staging\'</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span>NODE_ENV <span class="token operator">===</span> <span class="token string">\'production\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'./production\'</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n</code></pre>\n      </div>\n<p>react çš„æ‰“åŒ…æ–‡ä»¶çš„å…¥å£ä¹Ÿæ­£æ˜¯è¿™ä¹ˆåšçš„: <a href="https://github.com/facebook/react/blob/master/packages/react/npm/index.js">react/index.js at master Â· facebook/react</a>.</p>\n<p>è¿™ç§æƒ…å†µä¸‹åœ¨æ„å»ºæ—¶, å¦‚æœåœ¨ webpack ä¸­é€šè¿‡ <code class="language-text">EnvironmentPlugin</code> è®¾ç½®äº† <code class="language-text">process.env.NODE_ENV</code> çš„å€¼ä¹‹å, ä¼šè¢«æ›¿æ¢æˆå…·ä½“çš„å€¼, ç„¶ååŒ¹é…ä¸åˆ°çš„ <code class="language-text">if() {}</code> ä»£ç å—ä¼šè¢«ä»£ç å‹ç¼©å·¥å…·å»æ‰. ä»è€Œè¾¾åˆ°ä¸ç›¸å¹²çš„ é…ç½®ä¸ä¼šè¢«æ‰“åŒ…å·¥å…·æ‰“åŒ…è¿›æœ€ç»ˆçš„ bundle ä¸­.</p>\n<hr>\n<p><code class="language-text">app.js</code></p>\n<div class="gatsby-highlight">\n      <pre class="language-javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">{</span> API_BASE <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'@/config\'</span>\n</code></pre>\n      </div>\n<h3 id="å•ä¸ªæ–‡ä»¶"><a href="#%E5%8D%95%E4%B8%AA%E6%96%87%E4%BB%B6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>å•ä¸ªæ–‡ä»¶</h3>\n<p><code class="language-text">config.js</code></p>\n<div class="gatsby-highlight">\n      <pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> API_BASE\n\n<span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span>NODE_ENV <span class="token operator">===</span> <span class="token string">\'development\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  API_BASE <span class="token operator">=</span> <span class="token string">\'http://localhost:3000/api\'</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span>NODE_ENV <span class="token operator">===</span> <span class="token string">\'staging\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  API_BASE <span class="token operator">=</span> <span class="token string">\'https://staging.cool-app.com/api\'</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span>NODE_ENV <span class="token operator">===</span> <span class="token string">\'production\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  API_BASE <span class="token operator">=</span> <span class="token string">\'https://cool-app.com/api\'</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">export</span> <span class="token punctuation">{</span> API_BASE <span class="token punctuation">}</span>\n</code></pre>\n      </div>\n<hr>\n<p><code class="language-text">app.js</code></p>\n<div class="gatsby-highlight">\n      <pre class="language-javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">{</span> API_BASE <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'@/config\'</span>\n</code></pre>\n      </div>\n<p>æ˜¾è€Œæ˜“è§è¿™ç§æ–¹å¼æå…¶ç¹ç, éšç€æ–‡ä»¶æ•°çš„ä¸Šå‡, å…ˆä¸è€ƒè™‘å…¶ä»–, å…¶æ‰€å¸¦æ¥çš„æ¨¡æ¿ä»£ç é‡ä¹Ÿæ˜¯å·¨å¤§çš„. å…¶æ¶ˆé™¤ä¸éœ€è¦çš„å€¼çš„ä»£ç çš„æ–¹å¼å’Œä¸Šä¸€éƒ¨åˆ†çš„åŸç†ç›¸åŒ.</p>\n<h3 id="penvmacro"><a href="#penvmacro" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>penv.macro</h3>\n<div class="gatsby-highlight">\n      <pre class="language-javascript"><code class="language-javascript"><span class="token comment">// all of this code</span>\n<span class="token keyword">import</span> env <span class="token keyword">from</span> <span class="token string">\'penv.macro\'</span>\n\n<span class="token keyword">const</span> baseUrl <span class="token operator">=</span> <span class="token function">env</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n  development<span class="token punctuation">:</span> <span class="token string">\'http://localhost:3000/api\'</span><span class="token punctuation">,</span>\n  staging<span class="token punctuation">:</span> <span class="token string">\'https://staging.cool-app.com/api\'</span><span class="token punctuation">,</span>\n  production<span class="token punctuation">:</span> <span class="token string">\'https://cool-app.com/api\'</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span>\n\n<span class="token comment">// assuming process.env.NODE_ENV === \'staging\'</span>\n<span class="token comment">// â†“ â†“ â†“ transpiles to â†“ â†“ â†“</span>\n\n<span class="token keyword">const</span> baseUrl <span class="token operator">=</span> <span class="token string">\'https://staging.cool-app.com/api\'</span>\n\n<span class="token comment">// learn more: http://npm.im/penv.macro</span>\n</code></pre>\n      </div>\n<p>è¿™ç§æ–¹å¼çš„å¥½å¤„åœ¨äºå¯ä»¥å°±è¿‘ç»´æŠ¤ä¸€ä¸ªå˜é‡åœ¨ä¸åŒç¯å¢ƒä¸‹çš„å€¼, ä¸”ä½¿ç”¨æ–¹å¼å¾ˆé€æ˜, ä½¿ç”¨è€…åªéœ€è¦åƒä½¿ç”¨ä¸€ä¸ªæ™®é€šçš„æ–¹æ³•ä¸€æ ·æ¥ä½¿ç”¨å®ƒ. å¯¼å…¥é…ç½®æ–‡ä»¶æ—¶åªéœ€è¦åƒå¯¹å¾…ä¸€ä¸ªæ™®é€šçš„æ¨¡å—æ¥å¯¹å¾…å®ƒ, ä¸éœ€è¦ä½¿ç”¨é¢å¤–çš„åˆ«åé…ç½®æˆ–è€…åˆ¤æ–­.</p>\n<h3 id="ç»“è®º"><a href="#%E7%BB%93%E8%AE%BA" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>ç»“è®º</h3>\n<table>\n<thead>\n<tr>\n<th>â€”</th>\n<th>webpack</th>\n<th>å¤šé… \n<br />\n (åˆ«å)</th>\n<th>å¤šé… \n<br />\n (åŠ¨æ€å¯¼å‡º)</th>\n<th>å•é…</th>\n<th><code class="language-text">penv.macro</code></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>ä»£ç é‡</td>\n<td>âœ…</td>\n<td>ğŸš«</td>\n<td>ğŸš«</td>\n<td>âœ…</td>\n<td>âœ…</td>\n</tr>\n<tr>\n<td>å°±è¿‘ç®¡ç†</td>\n<td>âœ…</td>\n<td>ğŸš«</td>\n<td>ğŸš«</td>\n<td>ğŸš«</td>\n<td>âœ…</td>\n</tr>\n<tr>\n<td>ä¸ä¾èµ–å‹ç¼©å·¥å…·</td>\n<td>ğŸš«</td>\n<td>âœ…</td>\n<td>ğŸš«</td>\n<td>ğŸš«</td>\n<td>âœ…</td>\n</tr>\n<tr>\n<td>ä¸ä¾èµ– webpack</td>\n<td>ğŸš«</td>\n<td>âœ…</td>\n<td>ğŸš«</td>\n<td>ğŸš«</td>\n<td>âœ…</td>\n</tr>\n<tr>\n<td>ä¸ä¾èµ– babel</td>\n<td>âœ…</td>\n<td>ğŸš«</td>\n<td>âœ…</td>\n<td>âœ…</td>\n<td>ğŸš«</td>\n</tr>\n</tbody>\n</table>\n<p>å…¶ä¸­ <code class="language-text">penv.macro</code> çš„æ–¹å¼æ˜æ˜¾ä¼˜äºå…¶ä»–çš„æ–¹å¼, æˆ‘ä»¬ç°åœ¨å‰ç«¯çš„ä»£ç éš¾å…éƒ½ä¼šä¾èµ– babel, æ‰€ä»¥ä¾èµ– babel å®é™…ä¸Šä¸ç®—æ˜¯ä¸ªé—®é¢˜.</p>\n<p>å…¶ä¸­å°±è¿‘ç»´æŠ¤å˜é‡çš„å€¼å¾ˆé‡è¦. å¦‚æœä¸èƒ½å°±è¿‘ç»´æŠ¤, å‡è®¾ä½ åœ¨å¤šä¸ªæ–‡ä»¶ä¸­è®¾ç½®å˜é‡æ—¶, æ— è®ºæ˜¯ä¸€å¼€å§‹ç¼–å†™æŠ‘æˆ–æ˜¯ä¹‹åçš„äºŒæ¬¡ä¿®æ”¹, éƒ½å¿…é¡»è®°å¾—è¦ä¿®æ”¹å¤šä¸ªæ–‡ä»¶. æ—¶å¸¸ä¼šå‡ºç°åªæ”¹äº†ä¸€ä¸¤å¤„, è€Œæ¼æ‰å…¶ä»–åœ°æ–¹çš„æƒ…å†µ. è¿™ä¹Ÿæ˜¯æˆ‘ç¼–å†™ <code class="language-text">penv.macro</code> çš„ä¸»è¦åŠ¨æœº, å¸Œæœ›èƒ½åœ¨ä¸€ä¸ªä½ç½®çœ‹åˆ°è¯¥å˜é‡çš„å„ä¸ªç¯å¢ƒä¸‹çš„å€¼, è¿™æ ·æ›´èƒ½æŠŠæ¡ä¸€ä¸ªå˜é‡çš„æ•´ä½“æƒ…å†µ.</p>\n<p>ä¸ä¾èµ– webpack ä¹Ÿæ˜¯å¾ˆæœ‰å¿…è¦çš„, å¦‚æœæˆ‘ä»¬çš„ä»£ç éœ€è¦è¢«æµ‹è¯•, ä¸”æµ‹è¯•çš„ä»£ç ä¸å¾—ä¸ä¾èµ– webpack çš„è¯, é…ç½®æµ‹è¯•ç¯å¢ƒä¹Ÿå°†ä¼šå˜å¾—æ›´å¤æ‚. åº”å°½åŠ›é¿å…è¿™æ ·çš„æƒ…å†µå‘ç”Ÿ, å¾’å¢ä¸å¿…è¦çš„å¤æ‚åº¦æ˜¯ä¸æ˜æ™ºçš„.</p>\n<h2 id="babel-plugin-macros"><a href="#babel-plugin-macros" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>babel-plugin-macros</h2>\n<p><a href="https://github.com/kentcdodds/babel-plugin-macros"><code class="language-text">babel-plugin-macros</code></a> æ˜¯ä¸€ä¸ªç‰¹åˆ«çš„ babel æ’ä»¶, ç‰¹åˆ«åœ¨å®ƒæœ¬èº«ä¸æä¾›ä»»ä½•ç›´æ¥çš„åŠŸèƒ½. ä½ éœ€è¦ä½¿ç”¨åŸºäºå®ƒåˆ›å»ºå‡ºçš„ macro, å¹¶ä¸”åªéœ€è¦åœ¨ <code class="language-text">.babelrc</code> çš„ <code class="language-text">plugins</code> ä¸­ åŠ å…¥ <code class="language-text">babel-plugin-macros</code>. åç»­çš„ä½¿ç”¨åªéœ€è¦å¯¼å…¥å¯¹åº”çš„ macro, è€Œä¸éœ€è¦é¢å¤–é…ç½® <code class="language-text">.babelrc</code>.</p>\n<p>åœ¨æˆ‘çš„ç†è§£ä¸­, å¦‚æœç±»æ¯”è¯´ babel æ˜¯æä¾›äº†ä¸€ä¸ªå¹³å°, è€Œå„ä¸ª babel æ’ä»¶æ˜¯åŸºäº babel è¿™ä¸ªå¹³å°åˆ›å»ºçš„å·¥å…·. é‚£ä¹ˆ, <code class="language-text">babel-plugin-macros</code> å°±åƒæ˜¯åŸºäº babel æ’ä»¶ä¹‹ä¸Šåˆ›é€ äº†å¦ä¸€ä¸ªå¹³å°: æˆ‘ä»¬èƒ½åŸºäº <code class="language-text">babel-plugin-macros</code> ç¼–å†™æˆ‘ä»¬æƒ³è¦çš„ macro (æœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸€ä¸ª babel æ’ä»¶), åªä¸è¿‡æ¥å—çš„å‚æ•°æ˜¯ç”± <code class="language-text">babel-plugin-macros</code> ä¸ºæˆ‘ä»¬å¤„ç†è¿‡å†ä¼ é€’è¿‡æ¥çš„.</p>\n<p>ä¸€èˆ¬çš„ babel æ’ä»¶éƒ½æ˜¯<strong>éšå¼</strong>çš„, è¿™ä¹ˆè¯´çš„åŸå› æ˜¯ babel æ’ä»¶è¦ä¹ˆåŸºäºæŸç§è¯­æ³•, è¦ä¹ˆåŸºäºæŸç§å†™æ³•, å½“ç„¶ä¹Ÿæœ‰çš„ä¼šé€šè¿‡æ³¨é‡Šæ¥åªå¯¹éƒ¨åˆ†ä»£ç åšè½¬æ¢. ä¸æ­¤ç›¸æ¯”, åŸºäº <code class="language-text">babel-plugin-macros</code> ç¼–å†™çš„ macro æ˜¯<strong>æ˜¾ç¤º</strong>è°ƒç”¨å’Œæ‰§è¡Œçš„. å› ä¸ºæˆ‘ä»¬éœ€è¦ <code class="language-text">import</code> / <code class="language-text">require</code> <code class="language-text">xxx.macro</code>, ç„¶åä»¥ç±»ä¼¼å‡½æ•°è°ƒç”¨æˆ–è€…å…¶ä»–çš„æ–¹å¼ (æ¨¡æ¿æ ‡ç­¾ç­‰) æ¥ä½¿ç”¨å®ƒ. è™½ç„¶å®é™…ä¸Šä¸æ˜¯å‡½æ•°, ä½†æ˜¯æˆ‘ä»¬ç¡®å®èƒ½åœ¨ macro ä¸­è¯»åˆ°ç”¨æˆ·ä¼ ç»™å®ƒçš„å‚æ•°æˆ–è€…å…¶ä»–çš„å½¢å¼çš„ä¿¡æ¯, ç„¶åè½¬æ¢ç”¨æˆ·ç¼–å†™çš„ä»£ç .</p>\n<p>è¿™æ˜¯ä¸ªéå¸¸å…·æœ‰åˆ›æ„çš„æƒ³æ³•, <a href="https://kentcdodds.com/info/">Kent C. Dodds</a> æ‰“å¼€äº†æˆ‘ä»¬ä½¿ç”¨ babel æ’ä»¶çš„ä¸€ç§æ–°æ€è·¯. ä»¥ä¸‹æ˜¯ä½œè€…åœ¨ babel çš„åšå®¢ä¸­å‘å¸ƒçš„ç›¸å…³æ–‡ç« :</p>\n<p><a href="http://babeljs.io/blog/2017/09/11/zero-config-with-babel-macros">Zero-config code transformation with babel-plugin-macros Â· Babel</a></p>',frontmatter:{title:"penv.macro - ä½¿ç¯å¢ƒå˜é‡çš„è®¾ç½®æ›´åŠ ç®€å•",date:"April 10, 2018"}}},pathContext:{slug:"/penv.macro-use/",previous:{fields:{slug:"/fe-unit-testing-practice/"},frontmatter:{title:"å‰ç«¯å•å…ƒæµ‹è¯•å®è·µ"}},next:{fields:{slug:"/2018-review/"},frontmatter:{title:"2018 å¹´ç»ˆæ€»ç»“"}}}}}});
//# sourceMappingURL=path---penv-macro-use-4e604b4d71114bcf79bf.js.map